import { Injectable } from '@angular/core';
import { JoyrideBackdropService } from './joyride-backdrop.service';
import { EventListenerService } from './event-listener.service';
import { JoyrideStepsContainerService, StepActionType } from './joyride-steps-container.service';
import { DocumentService } from './document.service';
import { StepDrawerService } from './step-drawer.service';
import { DomRefService } from './dom.service';
import { NO_POSITION } from '../directives/joyride.directive';
import { JoyrideOptionsService } from './joyride-options.service';
import { Router } from '@angular/router';
import { ReplaySubject } from 'rxjs';
import { JoyrideStepDoesNotExist, JoyrideStepOutOfRange } from '../models/joyride-error.class';
import { LoggerService } from './logger.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './joyride-backdrop.service';
import * as ɵngcc2 from './event-listener.service';
import * as ɵngcc3 from './joyride-steps-container.service';
import * as ɵngcc4 from './document.service';
import * as ɵngcc5 from './dom.service';
import * as ɵngcc6 from './step-drawer.service';
import * as ɵngcc7 from './joyride-options.service';
import * as ɵngcc8 from '@angular/router';
import * as ɵngcc9 from './logger.service';
const SCROLLBAR_SIZE = 20;
export const DISTANCE_FROM_TARGET = 15;
export const ARROW_SIZE = 10;
export class JoyrideStepService {
    constructor(backDropService, eventListener, stepsContainerService, documentService, DOMService, stepDrawerService, optionsService, router, logger) {
        this.backDropService = backDropService;
        this.eventListener = eventListener;
        this.stepsContainerService = stepsContainerService;
        this.documentService = documentService;
        this.DOMService = DOMService;
        this.stepDrawerService = stepDrawerService;
        this.optionsService = optionsService;
        this.router = router;
        this.logger = logger;
        this.winTopPosition = 0;
        this.winBottomPosition = 0;
        this.stepsObserver = new ReplaySubject();
        this.initViewportPositions();
        this.subscribeToScrollEvents();
        this.subscribeToResizeEvents();
    }
    initViewportPositions() {
        this.winTopPosition = 0;
        this.winBottomPosition = this.DOMService.getNativeWindow().innerHeight - SCROLLBAR_SIZE;
    }
    subscribeToScrollEvents() {
        this.eventListener.startListeningScrollEvents();
        this.eventListener.scrollEvent.subscribe(scroll => {
            this.winTopPosition = scroll.scrollY;
            this.winBottomPosition = this.winTopPosition + this.DOMService.getNativeWindow().innerHeight - SCROLLBAR_SIZE;
            if (this.currentStep)
                this.backDropService.redraw(this.currentStep, scroll);
        });
    }
    subscribeToResizeEvents() {
        this.eventListener.resizeEvent.subscribe(() => {
            if (this.currentStep)
                this.backDropService.redrawTarget(this.currentStep);
        });
    }
    drawStep(step) {
        step.position = step.position === NO_POSITION ? this.optionsService.getStepDefaultPosition() : step.position;
        this.stepDrawerService.draw(step);
    }
    startTour() {
        this.stepsObserver = new ReplaySubject();
        this.stepsContainerService.init();
        this.documentService.setDocumentHeight();
        this.tryShowStep(StepActionType.NEXT);
        this.eventListener.startListeningResizeEvents();
        this.subscribeToStepsUpdates();
        return this.stepsObserver.asObservable();
    }
    close() {
        this.removeCurrentStep();
        this.notifyTourIsFinished();
        this.DOMService.getNativeWindow().scrollTo(0, 0);
        this.eventListener.stopListeningResizeEvents();
        this.backDropService.remove();
    }
    prev() {
        this.removeCurrentStep();
        this.currentStep.prevCliked.emit();
        this.tryShowStep(StepActionType.PREV);
    }
    next() {
        this.removeCurrentStep();
        this.currentStep.nextClicked.emit();
        this.tryShowStep(StepActionType.NEXT);
    }
    navigateToStepPage(action) {
        let stepRoute = this.stepsContainerService.getStepRoute(action);
        if (stepRoute) {
            this.router.navigate([stepRoute]);
        }
    }
    subscribeToStepsUpdates() {
        this.stepsContainerService.stepHasBeenModified.subscribe(updatedStep => {
            if (this.currentStep && this.currentStep.name === updatedStep.name) {
                this.currentStep = updatedStep;
            }
        });
    }
    tryShowStep(actionType) {
        this.navigateToStepPage(actionType);
        const timeout = this.optionsService.getWaitingTime();
        if (timeout > 100)
            this.backDropService.remove();
        setTimeout(() => {
            try {
                this.showStep(actionType);
            }
            catch (error) {
                if (error instanceof JoyrideStepDoesNotExist) {
                    this.tryShowStep(actionType);
                }
                else if (error instanceof JoyrideStepOutOfRange) {
                    this.logger.error('Forcing the tour closure: First or Last step not found in the DOM.');
                    this.close();
                }
                else {
                    throw new Error(error);
                }
            }
        }, timeout);
    }
    showStep(actionType) {
        this.currentStep = this.stepsContainerService.get(actionType);
        if (this.currentStep == null)
            throw new JoyrideStepDoesNotExist('');
        // Scroll the element to get it visible if it's in a scrollable element
        this.scrollIfElementBeyondOtherElements();
        this.backDropService.draw(this.currentStep);
        this.drawStep(this.currentStep);
        this.scrollIfStepAndTargetAreNotVisible();
        this.notifyStepClicked(actionType);
    }
    notifyStepClicked(actionType) {
        let stepInfo = {
            number: this.stepsContainerService.getStepNumber(this.currentStep.name),
            name: this.currentStep.name,
            route: this.currentStep.route,
            actionType
        };
        this.stepsObserver.next(stepInfo);
    }
    notifyTourIsFinished() {
        if (this.currentStep)
            this.currentStep.tourDone.emit();
        this.stepsObserver.complete();
    }
    removeCurrentStep() {
        if (this.currentStep)
            this.stepDrawerService.remove(this.currentStep);
    }
    scrollIfStepAndTargetAreNotVisible() {
        this.scrollWhenTargetOrStepAreHiddenBottom();
        this.scrollWhenTargetOrStepAreHiddenTop();
    }
    scrollWhenTargetOrStepAreHiddenBottom() {
        let totalTargetBottom = this.getMaxTargetAndStepBottomPosition();
        if (totalTargetBottom > this.winBottomPosition) {
            this.DOMService.getNativeWindow().scrollBy(0, totalTargetBottom - this.winBottomPosition);
        }
    }
    scrollWhenTargetOrStepAreHiddenTop() {
        let totalTargetTop = this.getMaxTargetAndStepTopPosition();
        if (totalTargetTop < this.winTopPosition) {
            this.DOMService.getNativeWindow().scrollBy(0, totalTargetTop - this.winTopPosition);
        }
    }
    getMaxTargetAndStepBottomPosition() {
        let targetAbsoluteTop = this.documentService.getElementAbsoluteTop(this.currentStep.targetViewContainer.element);
        if (this.currentStep.position === 'top') {
            return targetAbsoluteTop + this.currentStep.stepInstance.targetHeight;
        }
        else if (this.currentStep.position === 'bottom') {
            return (targetAbsoluteTop +
                this.currentStep.stepInstance.targetHeight +
                this.currentStep.stepInstance.stepHeight +
                ARROW_SIZE +
                DISTANCE_FROM_TARGET);
        }
        else if (this.currentStep.position === 'right' || this.currentStep.position === 'left') {
            return Math.max(targetAbsoluteTop + this.currentStep.stepInstance.targetHeight, targetAbsoluteTop + this.currentStep.stepInstance.targetHeight / 2 + this.currentStep.stepInstance.stepHeight / 2);
        }
    }
    getMaxTargetAndStepTopPosition() {
        let targetAbsoluteTop = this.documentService.getElementAbsoluteTop(this.currentStep.targetViewContainer.element);
        if (this.currentStep.position === 'top') {
            return targetAbsoluteTop - (this.currentStep.stepInstance.stepHeight + ARROW_SIZE + DISTANCE_FROM_TARGET);
        }
        else if (this.currentStep.position === 'bottom') {
            return targetAbsoluteTop;
        }
        else if (this.currentStep.position === 'right' || this.currentStep.position === 'left') {
            return Math.min(targetAbsoluteTop, targetAbsoluteTop + this.currentStep.stepInstance.targetHeight / 2 - this.currentStep.stepInstance.stepHeight / 2);
        }
    }
    scrollIfElementBeyondOtherElements() {
        if (this.isElementBeyondOthers() === 2) {
            this.documentService.scrollToTheTop(this.currentStep.targetViewContainer.element);
        }
        if (this.isElementBeyondOthers() === 2) {
            this.documentService.scrollToTheBottom(this.currentStep.targetViewContainer.element);
        }
        if (this.isElementBeyondOthers() === 1 && this.documentService.isParentScrollable(this.currentStep.targetViewContainer.element)) {
            this.documentService.scrollIntoView(this.currentStep.targetViewContainer.element, this.currentStep.isElementOrAncestorFixed);
        }
        if (this.isElementBeyondOthers() === 1 && this.documentService.isParentScrollable(this.currentStep.targetViewContainer.element)) {
            this.currentStep.targetViewContainer.element.nativeElement.scrollIntoView();
        }
    }
    isElementBeyondOthers() {
        return this.documentService.isElementBeyondOthers(this.currentStep.targetViewContainer.element, this.currentStep.isElementOrAncestorFixed, 'backdrop');
    }
}
JoyrideStepService.ɵfac = function JoyrideStepService_Factory(t) { return new (t || JoyrideStepService)(ɵngcc0.ɵɵinject(ɵngcc1.JoyrideBackdropService), ɵngcc0.ɵɵinject(ɵngcc2.EventListenerService), ɵngcc0.ɵɵinject(ɵngcc3.JoyrideStepsContainerService), ɵngcc0.ɵɵinject(ɵngcc4.DocumentService), ɵngcc0.ɵɵinject(ɵngcc5.DomRefService), ɵngcc0.ɵɵinject(ɵngcc6.StepDrawerService), ɵngcc0.ɵɵinject(ɵngcc7.JoyrideOptionsService), ɵngcc0.ɵɵinject(ɵngcc8.Router), ɵngcc0.ɵɵinject(ɵngcc9.LoggerService)); };
JoyrideStepService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: JoyrideStepService, factory: JoyrideStepService.ɵfac });
JoyrideStepService.ctorParameters = () => [
    { type: JoyrideBackdropService },
    { type: EventListenerService },
    { type: JoyrideStepsContainerService },
    { type: DocumentService },
    { type: DomRefService },
    { type: StepDrawerService },
    { type: JoyrideOptionsService },
    { type: Router },
    { type: LoggerService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(JoyrideStepService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.JoyrideBackdropService }, { type: ɵngcc2.EventListenerService }, { type: ɵngcc3.JoyrideStepsContainerService }, { type: ɵngcc4.DocumentService }, { type: ɵngcc5.DomRefService }, { type: ɵngcc6.StepDrawerService }, { type: ɵngcc7.JoyrideOptionsService }, { type: ɵngcc8.Router }, { type: ɵngcc9.LoggerService }]; }, null); })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiam95cmlkZS1zdGVwLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1qb3lyaWRlL3NyYy9saWIvc2VydmljZXMvam95cmlkZS1zdGVwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDakcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQzlELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsYUFBYSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBRWpELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQy9GLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7Ozs7Ozs7Ozs7QUFFakQsTUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDO0FBRTFCLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFHLEVBQUUsQ0FBQztBQUN2QyxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO0FBVTdCLE1BQU0sT0FBTyxrQkFBa0I7QUFBSSxJ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QUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBUkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBYkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQTFOQSxBQUFBLEFBMUJBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBREEsQUFBQSxBQUdBLEFBQUEsQUFDQSxBQUFBLEFBSUEsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSm95cmlkZVN0ZXAgfSBmcm9tICcuLi9tb2RlbHMvam95cmlkZS1zdGVwLmNsYXNzJztcclxuaW1wb3J0IHsgSm95cmlkZUJhY2tkcm9wU2VydmljZSB9IGZyb20gJy4vam95cmlkZS1iYWNrZHJvcC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRXZlbnRMaXN0ZW5lclNlcnZpY2UgfSBmcm9tICcuL2V2ZW50LWxpc3RlbmVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBKb3lyaWRlU3RlcHNDb250YWluZXJTZXJ2aWNlLCBTdGVwQWN0aW9uVHlwZSB9IGZyb20gJy4vam95cmlkZS1zdGVwcy1jb250YWluZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IERvY3VtZW50U2VydmljZSB9IGZyb20gJy4vZG9jdW1lbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IFN0ZXBEcmF3ZXJTZXJ2aWNlIH0gZnJvbSAnLi9zdGVwLWRyYXdlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRG9tUmVmU2VydmljZSB9IGZyb20gJy4vZG9tLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOT19QT1NJVElPTiB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvam95cmlkZS5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBKb3lyaWRlT3B0aW9uc1NlcnZpY2UgfSBmcm9tICcuL2pveXJpZGUtb3B0aW9ucy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBKb3lyaWRlU3RlcEluZm8gfSBmcm9tICcuLi9tb2RlbHMvam95cmlkZS1zdGVwLWluZm8uY2xhc3MnO1xyXG5pbXBvcnQgeyBKb3lyaWRlU3RlcERvZXNOb3RFeGlzdCwgSm95cmlkZVN0ZXBPdXRPZlJhbmdlIH0gZnJvbSAnLi4vbW9kZWxzL2pveXJpZGUtZXJyb3IuY2xhc3MnO1xyXG5pbXBvcnQgeyBMb2dnZXJTZXJ2aWNlIH0gZnJvbSAnLi9sb2dnZXIuc2VydmljZSc7XHJcblxyXG5jb25zdCBTQ1JPTExCQVJfU0laRSA9IDIwO1xyXG5cclxuZXhwb3J0IGNvbnN0IERJU1RBTkNFX0ZST01fVEFSR0VUID0gMTU7XHJcbmV4cG9ydCBjb25zdCBBUlJPV19TSVpFID0gMTA7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElKb3lyaWRlU3RlcFNlcnZpY2Uge1xyXG4gICAgc3RhcnRUb3VyKCk6IE9ic2VydmFibGU8Sm95cmlkZVN0ZXBJbmZvPjtcclxuICAgIGNsb3NlKCk6IGFueTtcclxuICAgIHByZXYoKTogYW55O1xyXG4gICAgbmV4dCgpOiBhbnk7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEpveXJpZGVTdGVwU2VydmljZSBpbXBsZW1lbnRzIElKb3lyaWRlU3RlcFNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBjdXJyZW50U3RlcDogSm95cmlkZVN0ZXA7XHJcbiAgICBwcml2YXRlIHdpblRvcFBvc2l0aW9uOiBudW1iZXIgPSAwO1xyXG4gICAgcHJpdmF0ZSB3aW5Cb3R0b21Qb3NpdGlvbjogbnVtYmVyID0gMDtcclxuICAgIHByaXZhdGUgc3RlcHNPYnNlcnZlcjogUmVwbGF5U3ViamVjdDxKb3lyaWRlU3RlcEluZm8+ID0gbmV3IFJlcGxheVN1YmplY3Q8Sm95cmlkZVN0ZXBJbmZvPigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYmFja0Ryb3BTZXJ2aWNlOiBKb3lyaWRlQmFja2Ryb3BTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgZXZlbnRMaXN0ZW5lcjogRXZlbnRMaXN0ZW5lclNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBzdGVwc0NvbnRhaW5lclNlcnZpY2U6IEpveXJpZGVTdGVwc0NvbnRhaW5lclNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBkb2N1bWVudFNlcnZpY2U6IERvY3VtZW50U2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IERPTVNlcnZpY2U6IERvbVJlZlNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBzdGVwRHJhd2VyU2VydmljZTogU3RlcERyYXdlclNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zU2VydmljZTogSm95cmlkZU9wdGlvbnNTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgcm91dGVyOiBSb3V0ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IExvZ2dlclNlcnZpY2VcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuaW5pdFZpZXdwb3J0UG9zaXRpb25zKCk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVUb1Njcm9sbEV2ZW50cygpO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlVG9SZXNpemVFdmVudHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRWaWV3cG9ydFBvc2l0aW9ucygpIHtcclxuICAgICAgICB0aGlzLndpblRvcFBvc2l0aW9uID0gMDtcclxuICAgICAgICB0aGlzLndpbkJvdHRvbVBvc2l0aW9uID0gdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZVdpbmRvdygpLmlubmVySGVpZ2h0IC0gU0NST0xMQkFSX1NJWkU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdWJzY3JpYmVUb1Njcm9sbEV2ZW50cygpIHtcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXIuc3RhcnRMaXN0ZW5pbmdTY3JvbGxFdmVudHMoKTtcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXIuc2Nyb2xsRXZlbnQuc3Vic2NyaWJlKHNjcm9sbCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMud2luVG9wUG9zaXRpb24gPSBzY3JvbGwuc2Nyb2xsWTtcclxuICAgICAgICAgICAgdGhpcy53aW5Cb3R0b21Qb3NpdGlvbiA9IHRoaXMud2luVG9wUG9zaXRpb24gKyB0aGlzLkRPTVNlcnZpY2UuZ2V0TmF0aXZlV2luZG93KCkuaW5uZXJIZWlnaHQgLSBTQ1JPTExCQVJfU0laRTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFN0ZXApIHRoaXMuYmFja0Ryb3BTZXJ2aWNlLnJlZHJhdyh0aGlzLmN1cnJlbnRTdGVwLCBzY3JvbGwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3Vic2NyaWJlVG9SZXNpemVFdmVudHMoKSB7XHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVyLnJlc2l6ZUV2ZW50LnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwKSB0aGlzLmJhY2tEcm9wU2VydmljZS5yZWRyYXdUYXJnZXQodGhpcy5jdXJyZW50U3RlcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3U3RlcChzdGVwOiBKb3lyaWRlU3RlcCkge1xyXG4gICAgICAgIHN0ZXAucG9zaXRpb24gPSBzdGVwLnBvc2l0aW9uID09PSBOT19QT1NJVElPTiA/IHRoaXMub3B0aW9uc1NlcnZpY2UuZ2V0U3RlcERlZmF1bHRQb3NpdGlvbigpIDogc3RlcC5wb3NpdGlvbjtcclxuICAgICAgICB0aGlzLnN0ZXBEcmF3ZXJTZXJ2aWNlLmRyYXcoc3RlcCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhcnRUb3VyKCk6IE9ic2VydmFibGU8Sm95cmlkZVN0ZXBJbmZvPiB7XHJcbiAgICAgICAgdGhpcy5zdGVwc09ic2VydmVyID0gbmV3IFJlcGxheVN1YmplY3Q8Sm95cmlkZVN0ZXBJbmZvPigpO1xyXG4gICAgICAgIHRoaXMuc3RlcHNDb250YWluZXJTZXJ2aWNlLmluaXQoKTtcclxuICAgICAgICB0aGlzLmRvY3VtZW50U2VydmljZS5zZXREb2N1bWVudEhlaWdodCgpO1xyXG5cclxuICAgICAgICB0aGlzLnRyeVNob3dTdGVwKFN0ZXBBY3Rpb25UeXBlLk5FWFQpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lci5zdGFydExpc3RlbmluZ1Jlc2l6ZUV2ZW50cygpO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlVG9TdGVwc1VwZGF0ZXMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGVwc09ic2VydmVyLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQ3VycmVudFN0ZXAoKTtcclxuICAgICAgICB0aGlzLm5vdGlmeVRvdXJJc0ZpbmlzaGVkKCk7XHJcbiAgICAgICAgdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZVdpbmRvdygpLnNjcm9sbFRvKDAsIDApO1xyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lci5zdG9wTGlzdGVuaW5nUmVzaXplRXZlbnRzKCk7XHJcbiAgICAgICAgdGhpcy5iYWNrRHJvcFNlcnZpY2UucmVtb3ZlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJldigpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUN1cnJlbnRTdGVwKCk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50U3RlcC5wcmV2Q2xpa2VkLmVtaXQoKTtcclxuICAgICAgICB0aGlzLnRyeVNob3dTdGVwKFN0ZXBBY3Rpb25UeXBlLlBSRVYpO1xyXG4gICAgfVxyXG5cclxuICAgIG5leHQoKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVDdXJyZW50U3RlcCgpO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFN0ZXAubmV4dENsaWNrZWQuZW1pdCgpO1xyXG4gICAgICAgIHRoaXMudHJ5U2hvd1N0ZXAoU3RlcEFjdGlvblR5cGUuTkVYVCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBuYXZpZ2F0ZVRvU3RlcFBhZ2UoYWN0aW9uOiBTdGVwQWN0aW9uVHlwZSkge1xyXG4gICAgICAgIGxldCBzdGVwUm91dGUgPSB0aGlzLnN0ZXBzQ29udGFpbmVyU2VydmljZS5nZXRTdGVwUm91dGUoYWN0aW9uKTtcclxuICAgICAgICBpZiAoc3RlcFJvdXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtzdGVwUm91dGVdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdWJzY3JpYmVUb1N0ZXBzVXBkYXRlcygpIHtcclxuICAgICAgICB0aGlzLnN0ZXBzQ29udGFpbmVyU2VydmljZS5zdGVwSGFzQmVlbk1vZGlmaWVkLnN1YnNjcmliZSh1cGRhdGVkU3RlcCA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwICYmIHRoaXMuY3VycmVudFN0ZXAubmFtZSA9PT0gdXBkYXRlZFN0ZXAubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IHVwZGF0ZWRTdGVwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB0cnlTaG93U3RlcChhY3Rpb25UeXBlOiBTdGVwQWN0aW9uVHlwZSkge1xyXG4gICAgICAgIHRoaXMubmF2aWdhdGVUb1N0ZXBQYWdlKGFjdGlvblR5cGUpO1xyXG4gICAgICAgIGNvbnN0IHRpbWVvdXQgPSB0aGlzLm9wdGlvbnNTZXJ2aWNlLmdldFdhaXRpbmdUaW1lKCk7XHJcbiAgICAgICAgaWYgKHRpbWVvdXQgPiAxMDApIHRoaXMuYmFja0Ryb3BTZXJ2aWNlLnJlbW92ZSgpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93U3RlcChhY3Rpb25UeXBlKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEpveXJpZGVTdGVwRG9lc05vdEV4aXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cnlTaG93U3RlcChhY3Rpb25UeXBlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBKb3lyaWRlU3RlcE91dE9mUmFuZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcignRm9yY2luZyB0aGUgdG91ciBjbG9zdXJlOiBGaXJzdCBvciBMYXN0IHN0ZXAgbm90IGZvdW5kIGluIHRoZSBET00uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgdGltZW91dCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93U3RlcChhY3Rpb25UeXBlOiBTdGVwQWN0aW9uVHlwZSkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudFN0ZXAgPSB0aGlzLnN0ZXBzQ29udGFpbmVyU2VydmljZS5nZXQoYWN0aW9uVHlwZSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwID09IG51bGwpIHRocm93IG5ldyBKb3lyaWRlU3RlcERvZXNOb3RFeGlzdCgnJyk7XHJcbiAgICAgICAgLy8gU2Nyb2xsIHRoZSBlbGVtZW50IHRvIGdldCBpdCB2aXNpYmxlIGlmIGl0J3MgaW4gYSBzY3JvbGxhYmxlIGVsZW1lbnRcclxuICAgICAgICB0aGlzLnNjcm9sbElmRWxlbWVudEJleW9uZE90aGVyRWxlbWVudHMoKTtcclxuICAgICAgICB0aGlzLmJhY2tEcm9wU2VydmljZS5kcmF3KHRoaXMuY3VycmVudFN0ZXApO1xyXG4gICAgICAgIHRoaXMuZHJhd1N0ZXAodGhpcy5jdXJyZW50U3RlcCk7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxJZlN0ZXBBbmRUYXJnZXRBcmVOb3RWaXNpYmxlKCk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTdGVwQ2xpY2tlZChhY3Rpb25UeXBlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG5vdGlmeVN0ZXBDbGlja2VkKGFjdGlvblR5cGU6IFN0ZXBBY3Rpb25UeXBlKSB7XHJcbiAgICAgICAgbGV0IHN0ZXBJbmZvOiBKb3lyaWRlU3RlcEluZm8gPSB7XHJcbiAgICAgICAgICAgIG51bWJlcjogdGhpcy5zdGVwc0NvbnRhaW5lclNlcnZpY2UuZ2V0U3RlcE51bWJlcih0aGlzLmN1cnJlbnRTdGVwLm5hbWUpLFxyXG4gICAgICAgICAgICBuYW1lOiB0aGlzLmN1cnJlbnRTdGVwLm5hbWUsXHJcbiAgICAgICAgICAgIHJvdXRlOiB0aGlzLmN1cnJlbnRTdGVwLnJvdXRlLFxyXG4gICAgICAgICAgICBhY3Rpb25UeXBlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnN0ZXBzT2JzZXJ2ZXIubmV4dChzdGVwSW5mbyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBub3RpZnlUb3VySXNGaW5pc2hlZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50U3RlcCkgdGhpcy5jdXJyZW50U3RlcC50b3VyRG9uZS5lbWl0KCk7XHJcbiAgICAgICAgdGhpcy5zdGVwc09ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlbW92ZUN1cnJlbnRTdGVwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwKSB0aGlzLnN0ZXBEcmF3ZXJTZXJ2aWNlLnJlbW92ZSh0aGlzLmN1cnJlbnRTdGVwKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjcm9sbElmU3RlcEFuZFRhcmdldEFyZU5vdFZpc2libGUoKSB7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxXaGVuVGFyZ2V0T3JTdGVwQXJlSGlkZGVuQm90dG9tKCk7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxXaGVuVGFyZ2V0T3JTdGVwQXJlSGlkZGVuVG9wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzY3JvbGxXaGVuVGFyZ2V0T3JTdGVwQXJlSGlkZGVuQm90dG9tKCkge1xyXG4gICAgICAgIGxldCB0b3RhbFRhcmdldEJvdHRvbSA9IHRoaXMuZ2V0TWF4VGFyZ2V0QW5kU3RlcEJvdHRvbVBvc2l0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRvdGFsVGFyZ2V0Qm90dG9tID4gdGhpcy53aW5Cb3R0b21Qb3NpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLkRPTVNlcnZpY2UuZ2V0TmF0aXZlV2luZG93KCkuc2Nyb2xsQnkoMCwgdG90YWxUYXJnZXRCb3R0b20gLSB0aGlzLndpbkJvdHRvbVBvc2l0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzY3JvbGxXaGVuVGFyZ2V0T3JTdGVwQXJlSGlkZGVuVG9wKCkge1xyXG4gICAgICAgIGxldCB0b3RhbFRhcmdldFRvcCA9IHRoaXMuZ2V0TWF4VGFyZ2V0QW5kU3RlcFRvcFBvc2l0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRvdGFsVGFyZ2V0VG9wIDwgdGhpcy53aW5Ub3BQb3NpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLkRPTVNlcnZpY2UuZ2V0TmF0aXZlV2luZG93KCkuc2Nyb2xsQnkoMCwgdG90YWxUYXJnZXRUb3AgLSB0aGlzLndpblRvcFBvc2l0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNYXhUYXJnZXRBbmRTdGVwQm90dG9tUG9zaXRpb24oKTogbnVtYmVyIHtcclxuICAgICAgICBsZXQgdGFyZ2V0QWJzb2x1dGVUb3AgPSB0aGlzLmRvY3VtZW50U2VydmljZS5nZXRFbGVtZW50QWJzb2x1dGVUb3AodGhpcy5jdXJyZW50U3RlcC50YXJnZXRWaWV3Q29udGFpbmVyLmVsZW1lbnQpO1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwLnBvc2l0aW9uID09PSAndG9wJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0QWJzb2x1dGVUb3AgKyB0aGlzLmN1cnJlbnRTdGVwLnN0ZXBJbnN0YW5jZS50YXJnZXRIZWlnaHQ7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRTdGVwLnBvc2l0aW9uID09PSAnYm90dG9tJykge1xyXG4gICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0QWJzb2x1dGVUb3AgK1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RlcC5zdGVwSW5zdGFuY2UudGFyZ2V0SGVpZ2h0ICtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFN0ZXAuc3RlcEluc3RhbmNlLnN0ZXBIZWlnaHQgK1xyXG4gICAgICAgICAgICAgICAgQVJST1dfU0laRSArXHJcbiAgICAgICAgICAgICAgICBESVNUQU5DRV9GUk9NX1RBUkdFVFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50U3RlcC5wb3NpdGlvbiA9PT0gJ3JpZ2h0JyB8fCB0aGlzLmN1cnJlbnRTdGVwLnBvc2l0aW9uID09PSAnbGVmdCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0QWJzb2x1dGVUb3AgKyB0aGlzLmN1cnJlbnRTdGVwLnN0ZXBJbnN0YW5jZS50YXJnZXRIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICB0YXJnZXRBYnNvbHV0ZVRvcCArIHRoaXMuY3VycmVudFN0ZXAuc3RlcEluc3RhbmNlLnRhcmdldEhlaWdodCAvIDIgKyB0aGlzLmN1cnJlbnRTdGVwLnN0ZXBJbnN0YW5jZS5zdGVwSGVpZ2h0IC8gMlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE1heFRhcmdldEFuZFN0ZXBUb3BQb3NpdGlvbigpIHtcclxuICAgICAgICBsZXQgdGFyZ2V0QWJzb2x1dGVUb3AgPSB0aGlzLmRvY3VtZW50U2VydmljZS5nZXRFbGVtZW50QWJzb2x1dGVUb3AodGhpcy5jdXJyZW50U3RlcC50YXJnZXRWaWV3Q29udGFpbmVyLmVsZW1lbnQpO1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwLnBvc2l0aW9uID09PSAndG9wJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0QWJzb2x1dGVUb3AgLSAodGhpcy5jdXJyZW50U3RlcC5zdGVwSW5zdGFuY2Uuc3RlcEhlaWdodCArIEFSUk9XX1NJWkUgKyBESVNUQU5DRV9GUk9NX1RBUkdFVCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRTdGVwLnBvc2l0aW9uID09PSAnYm90dG9tJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0QWJzb2x1dGVUb3A7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRTdGVwLnBvc2l0aW9uID09PSAncmlnaHQnIHx8IHRoaXMuY3VycmVudFN0ZXAucG9zaXRpb24gPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oXHJcbiAgICAgICAgICAgICAgICB0YXJnZXRBYnNvbHV0ZVRvcCxcclxuICAgICAgICAgICAgICAgIHRhcmdldEFic29sdXRlVG9wICsgdGhpcy5jdXJyZW50U3RlcC5zdGVwSW5zdGFuY2UudGFyZ2V0SGVpZ2h0IC8gMiAtIHRoaXMuY3VycmVudFN0ZXAuc3RlcEluc3RhbmNlLnN0ZXBIZWlnaHQgLyAyXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2Nyb2xsSWZFbGVtZW50QmV5b25kT3RoZXJFbGVtZW50cygpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0VsZW1lbnRCZXlvbmRPdGhlcnMoKSA9PT0gMikge1xyXG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50U2VydmljZS5zY3JvbGxUb1RoZVRvcCh0aGlzLmN1cnJlbnRTdGVwLnRhcmdldFZpZXdDb250YWluZXIuZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzRWxlbWVudEJleW9uZE90aGVycygpID09PSAyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRTZXJ2aWNlLnNjcm9sbFRvVGhlQm90dG9tKHRoaXMuY3VycmVudFN0ZXAudGFyZ2V0Vmlld0NvbnRhaW5lci5lbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaXNFbGVtZW50QmV5b25kT3RoZXJzKCkgPT09IDEgJiYgdGhpcy5kb2N1bWVudFNlcnZpY2UuaXNQYXJlbnRTY3JvbGxhYmxlKHRoaXMuY3VycmVudFN0ZXAudGFyZ2V0Vmlld0NvbnRhaW5lci5lbGVtZW50KSkge1xyXG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50U2VydmljZS5zY3JvbGxJbnRvVmlldyh0aGlzLmN1cnJlbnRTdGVwLnRhcmdldFZpZXdDb250YWluZXIuZWxlbWVudCwgdGhpcy5jdXJyZW50U3RlcC5pc0VsZW1lbnRPckFuY2VzdG9yRml4ZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pc0VsZW1lbnRCZXlvbmRPdGhlcnMoKSA9PT0gMSAmJiB0aGlzLmRvY3VtZW50U2VydmljZS5pc1BhcmVudFNjcm9sbGFibGUodGhpcy5jdXJyZW50U3RlcC50YXJnZXRWaWV3Q29udGFpbmVyLmVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0ZXAudGFyZ2V0Vmlld0NvbnRhaW5lci5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0VsZW1lbnRCZXlvbmRPdGhlcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmlzRWxlbWVudEJleW9uZE90aGVycyhcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RlcC50YXJnZXRWaWV3Q29udGFpbmVyLmVsZW1lbnQsXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0ZXAuaXNFbGVtZW50T3JBbmNlc3RvckZpeGVkLFxyXG4gICAgICAgICAgICAnYmFja2Ryb3AnXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG4iXX0=