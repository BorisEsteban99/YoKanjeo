import { __awaiter, __decorate, __metadata } from "tslib";
import { Component, ElementRef, Input, Output, EventEmitter } from '@angular/core';
import { GoogleChartsLoaderService } from '../google-charts-loader.service';
import { GoogleChartsDataTable } from '../google-charts-datatable';
import { ChartHTMLTooltip } from './chart-html-tooltip';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../google-charts-loader.service';
let GoogleChartComponent = class GoogleChartComponent {
    constructor(el, loaderService) {
        this.el = el;
        this.loaderService = loaderService;
        this.mouseOverListener = (item) => {
            const event = this.parseMouseEvent(item);
            event.tooltip = this.getHTMLTooltip();
            return event;
        };
        this.mouseOutListener = (item) => {
            const event = this.parseMouseEvent(item);
            return event;
        };
        this.selectListener = () => {
            const event = {
                message: 'select',
                row: null,
                column: null,
                selectedRowValues: [],
                selectedRowFormattedValues: [],
                columnLabel: ''
            };
            const s = this.wrapper.visualization.getSelection();
            const gs = s[s.length - 1];
            if (!gs) {
                event.message = 'deselect';
                return event;
            }
            const selection = gs;
            if (gs.row != null) {
                event.row = selection.row;
                const selectedRowValues = [];
                const selectedRowFormattedValues = [];
                const dataTable = this.wrapper.getDataTable();
                const numberOfColumns = dataTable.getNumberOfColumns();
                for (let i = 0; i < numberOfColumns; i++) {
                    selectedRowValues.push(dataTable.getValue(selection.row, i));
                    selectedRowFormattedValues.push(dataTable.getFormattedValue(selection.row, i));
                }
                event.selectedRowValues = selectedRowValues;
                event.selectedRowFormattedValues = selectedRowFormattedValues;
            }
            if (selection.column != null) {
                event.column = selection.column;
                event.columnLabel = this.getColumnLabelAtPosition(selection);
            }
            if (gs.name) {
                event.columnLabel = gs.name;
            }
            return event;
        };
        this.chartSelect = new EventEmitter();
        this.chartSelectOneTime = new EventEmitter();
        this.chartReady = new EventEmitter();
        this.chartReadyOneTime = new EventEmitter();
        this.chartError = new EventEmitter();
        this.chartErrorOneTime = new EventEmitter();
        this.mouseOver = new EventEmitter();
        this.mouseOverOneTime = new EventEmitter();
        this.mouseOut = new EventEmitter();
        this.mouseOutOneTime = new EventEmitter();
        this.regionClick = new EventEmitter();
        this.regionClickOneTime = new EventEmitter();
    }
    ngOnInit() {
        this.HTMLel = this.el.nativeElement.querySelector('div');
        if (Object.isExtensible(this.data)) {
            this.data.component = this;
        }
        this.options = this.data.options;
        this.init().then(() => {
            this.draw();
        });
    }
    init() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.loaderService.load();
            this.recreateWrapper();
        });
    }
    recreateWrapper() {
        if (this.wrapper === undefined || this.wrapper.getChartType() !== this.data.chartType) {
            this.dataTable = new GoogleChartsDataTable(this.data);
            this.dataTable.dataTableChanged.subscribe((dt) => {
                this._draw();
            });
            // see dataTable in https://developers.google.com/chart/interactive/docs/reference#google.visualization.drawchart
            let temp = this.data;
            if (this.data.firstRowIsData) {
                temp = Object.assign(temp, this.data);
                temp.dataTable = this.dataTable.getDataTable();
            }
            this.wrapper = new google.visualization.ChartWrapper(temp);
            this.registerChartWrapperEvents();
            /* Calling draw even without data is the only way to pass the HTMl element
               when using the chart in a dashboard. Don't do this in all other cases:
               it breaks formatters with remote data source, hence the conditional. */
            if (temp.dataTable === undefined && temp.dataSourceUrl === undefined) {
                try {
                    this.wrapper.draw(this.HTMLel);
                }
                catch (err) { }
            }
        }
    }
    _draw() {
        return __awaiter(this, void 0, void 0, function* () {
            const dt = this.dataTable.getDataTable();
            if (dt === undefined) {
                return;
            }
            this.convertOptions();
            this.recreateWrapper();
            this.wrapper.setOptions(this.options);
            this.wrapper.setDataTable(dt);
            this.wrapper.draw(this.HTMLel);
        });
    }
    getDataTable() {
        return this.dataTable;
    }
    draw(value) {
        if (value === undefined) {
            value = this.data;
        }
        this.options = value.options;
        this.dataTable.init(value);
    }
    getSelectorBySeriesType(seriesType) {
        const selectors = {
            bars: 'bar#%s#%r',
            haxis: 'hAxis#0#label',
            line: 'point#%s#%r',
            legend: 'legendentry#%s',
            area: 'point#%s#%r'
        };
        const selector = selectors[seriesType];
        return selector;
    }
    /**
     * Given a column number, counts how many
     * columns have rol=="data". Those are mapped
     * one-to-one to the series array. When rol is not defined
     * a column of type number means a series column.
     * @param column to inspect
     */
    getSeriesByColumn(column) {
        let series = 0;
        const dataTable = this.wrapper.getDataTable();
        for (let i = column - 1; i >= 0; i--) {
            const role = dataTable.getColumnRole(i);
            const type = dataTable.getColumnType(i);
            if (role === 'data' || type === 'number') {
                series++;
            }
        }
        return series;
    }
    getBoundingBoxForItem(item) {
        let boundingBox = { top: 0, left: 0, width: 0, height: 0 };
        if (this.cli) {
            const column = item.column;
            const series = this.getSeriesByColumn(column);
            const row = item.row;
            let seriesType = this.options.seriesType;
            if (this.options.series && this.options.series[series] && this.options.series[series].type) {
                seriesType = this.options.series[series].type;
            }
            if (seriesType) {
                let selector = this.getSelectorBySeriesType(seriesType);
                if (selector) {
                    selector = selector.replace('%s', series + '').replace('%c', column + '').replace('%r', row + '');
                    const box = this.cli.getBoundingBox(selector);
                    if (box) {
                        boundingBox = box;
                    }
                }
            }
        }
        return boundingBox;
    }
    getValueAtPosition(position) {
        if (position.row == null) {
            return null;
        }
        const dataTable = this.wrapper.getDataTable();
        const value = dataTable.getValue(position.row, position.column);
        return value;
    }
    getColumnTypeAtPosition(position) {
        const dataTable = this.wrapper.getDataTable();
        const type = dataTable.getColumnType(position.column) || '';
        return type;
    }
    getColumnLabelAtPosition(position) {
        const dataTable = this.wrapper.getDataTable();
        const type = dataTable.getColumnLabel(position.column) || '';
        return type;
    }
    getHTMLTooltip() {
        const tooltipER = new ElementRef(this.el.nativeElement.querySelector('.google-visualization-tooltip'));
        return new ChartHTMLTooltip(tooltipER);
    }
    parseMouseEvent(item) {
        const chartType = this.wrapper.getChartType();
        let eventColumn = item.column;
        if (eventColumn == null) {
            switch (chartType) {
                case 'Timeline':
                    eventColumn = this.wrapper.getDataTable().getNumberOfColumns() === 3 ? 0 : 1;
                    break;
                default:
                    eventColumn = 0;
            }
        }
        const eventRow = item.row;
        const myItem = {
            row: eventRow,
            column: eventColumn
        };
        const event = {
            position: item,
            boundingBox: this.getBoundingBoxForItem(myItem),
            value: this.getValueAtPosition(myItem),
            columnType: this.getColumnTypeAtPosition(myItem),
            columnLabel: this.getColumnLabelAtPosition(myItem)
        };
        return event;
    }
    unregisterEvents() {
        google.visualization.events.removeAllListeners(this.wrapper.getChart());
        google.visualization.events.removeAllListeners(this.wrapper);
    }
    registerChartEvents() {
        const chart = this.wrapper.getChart();
        this.cli = chart.getChartLayoutInterface ? chart.getChartLayoutInterface() : null;
        if (this.mouseOver.observers.length > 0) {
            google.visualization.events.addListener(chart, 'onmouseover', (item) => {
                const event = this.parseMouseEvent(item);
                event.tooltip = this.getHTMLTooltip();
                this.mouseOver.emit(event);
            });
        }
        if (this.mouseOverOneTime.observers.length > 0) {
            google.visualization.events.addOneTimeListener(chart, 'onmouseover', (item) => {
                const event = this.parseMouseEvent(item);
                event.tooltip = this.getHTMLTooltip();
                this.mouseOverOneTime.emit(event);
            });
        }
        if (this.mouseOut.observers.length > 0) {
            google.visualization.events.addListener(chart, 'onmouseout', (item) => {
                const event = this.parseMouseEvent(item);
                this.mouseOut.emit(event);
            });
        }
        if (this.mouseOutOneTime.observers.length > 0) {
            google.visualization.events.addOneTimeListener(chart, 'onmouseout', (item) => {
                const event = this.parseMouseEvent(item);
                this.mouseOutOneTime.emit(event);
            });
        }
        if (this.data.chartType === 'GeoChart') {
            if (this.regionClick.observers.length > 0) {
                google.visualization.events.addListener(chart, 'regionClick', (item) => {
                    this.regionClick.emit(item);
                });
            }
            if (this.regionClickOneTime.observers.length > 0) {
                google.visualization.events.addOneTimeListener(chart, 'regionClick', (item) => {
                    this.regionClick.emit(item);
                });
            }
        }
    }
    registerChartWrapperEvents() {
        google.visualization.events.addListener(this.wrapper, 'ready', () => {
            this.chartReady.emit({ message: 'Chart ready' });
        });
        google.visualization.events.addOneTimeListener(this.wrapper, 'ready', () => {
            this.chartReadyOneTime.emit({ message: 'Chart ready (one time)' });
            this.registerChartEvents();
        });
        google.visualization.events.addListener(this.wrapper, 'error', (error) => {
            this.chartError.emit(error);
        });
        google.visualization.events.addOneTimeListener(this.wrapper, 'error', (error) => {
            this.chartErrorOneTime.emit(error);
        });
        this.addListener(this.wrapper, 'select', this.selectListener, this.chartSelect);
        this.addOneTimeListener(this.wrapper, 'select', this.selectListener, this.chartSelectOneTime);
    }
    addListener(source, eventType, listenerFn, evEmitter) {
        google.visualization.events.addListener(source, eventType, () => {
            evEmitter.emit(listenerFn());
        });
    }
    addOneTimeListener(source, eventType, listenerFn, evEmitter) {
        google.visualization.events.addOneTimeListener(source, eventType, () => {
            evEmitter.emit(listenerFn());
        });
    }
    convertOptions() {
        try {
            this.options = google.charts[this.data.chartType].convertOptions(this.options);
        }
        catch (error) {
            return;
        }
    }
};
GoogleChartComponent.ɵfac = function GoogleChartComponent_Factory(t) { return new (t || GoogleChartComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.GoogleChartsLoaderService)); };
GoogleChartComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: GoogleChartComponent, selectors: [["google-chart"]], inputs: { data: "data" }, outputs: { chartSelect: "chartSelect", chartSelectOneTime: "chartSelectOneTime", chartReady: "chartReady", chartReadyOneTime: "chartReadyOneTime", chartError: "chartError", chartErrorOneTime: "chartErrorOneTime", mouseOver: "mouseOver", mouseOverOneTime: "mouseOverOneTime", mouseOut: "mouseOut", mouseOutOneTime: "mouseOutOneTime", regionClick: "regionClick", regionClickOneTime: "regionClickOneTime" }, decls: 1, vars: 0, template: function GoogleChartComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div");
    } }, encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", Object)
], GoogleChartComponent.prototype, "data", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartReady", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartReadyOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartError", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartErrorOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartSelect", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartSelectOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOver", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOverOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOut", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOutOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "regionClick", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "regionClickOneTime", void 0);
GoogleChartComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
        GoogleChartsLoaderService])
], GoogleChartComponent);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(GoogleChartComponent, [{
        type: Component,
        args: [{
                selector: 'google-chart',
                template: '<div></div>'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.GoogleChartsLoaderService }]; }, { chartSelect: [{
            type: Output
        }], chartSelectOneTime: [{
            type: Output
        }], chartReady: [{
            type: Output
        }], chartReadyOneTime: [{
            type: Output
        }], chartError: [{
            type: Output
        }], chartErrorOneTime: [{
            type: Output
        }], mouseOver: [{
            type: Output
        }], mouseOverOneTime: [{
            type: Output
        }], mouseOut: [{
            type: Output
        }], mouseOutOneTime: [{
            type: Output
        }], regionClick: [{
            type: Output
        }], regionClickOneTime: [{
            type: Output
        }], data: [{
            type: Input
        }] }); })();
export { GoogleChartComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmcyLWdvb2dsZS1jaGFydHMvc3JjL2xpYi9nb29nbGUtY2hhcnQvZ29vZ2xlLWNoYXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBRVYsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDNUUsT0FBTyxFQUFFLHFCQUFxQixFQUFrQyxNQUFNLDRCQUE0QixDQUFDO0FBV25HLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7QUFjeEQsSUFBYSxvQkFBb0IsR0FBakMsTUFBYSxvQkFBb0I7QUFBRyxJQTZCbEMsWUFBMkIsRUFBYyxFQUNkLGFBQXdDO0FBQ3JFLFFBRjZCLE9BQUUsR0FBRixFQUFFLENBQVk7QUFBQyxRQUNmLGtCQUFhLEdBQWIsYUFBYSxDQUEyQjtBQUFDLFFBd1I1RCxzQkFBaUIsR0FBRyxDQUFDLElBQXVCLEVBQUUsRUFBRTtBQUMxRCxZQUFJLE1BQU0sS0FBSyxHQUF3QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBd0IsQ0FBQztBQUN6RixZQUFJLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0FBQzFDLFlBQUksT0FBTyxLQUFLLENBQUM7QUFDakIsUUFBRSxDQUFDLENBQUE7QUFDSCxRQUNVLHFCQUFnQixHQUFHLENBQUMsSUFBdUIsRUFBRSxFQUFFO0FBQ3pELFlBQUksTUFBTSxLQUFLLEdBQXVCLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUF1QixDQUFDO0FBQ3ZGLFlBQUksT0FBTyxLQUFLLENBQUM7QUFDakIsUUFBRSxDQUFDLENBQUE7QUFDSCxRQUNV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QWEsSUFBdEIsTUFBTSxFQUFFO0FBQUUsOEJBQTBCLFlBQVk7QUFBRSxnRUFBaUI7QUFFMUQ7QUFBYSxJQUF0QixNQUFNLEVBQUU7QUFBRSw4QkFBaUIsWUFBWTtBQUFFLHVEQUFvQjtBQUNwRDtBQUFhLElBQXRCLE1BQU0sRUFBRTtBQUFFLDhCQUF3QixZQUFZO0FBQUUsOERBQW9CO0FBRTNEO0FBQWEsSUFBdEIsTUFBTSxFQUFFO0FBQUUsOEJBQWdCLFlBQVk7QUFBRSxzREFBbUI7QUFDbEQ7QUFBYSxJQUF0QixNQUFNLEVBQUU7QUFBRSw4QkFBdUIsWUFBWTtBQUFFLDZEQUFtQjtBQUV6RDtBQUFhLElBQXRCLE1BQU0sRUFBRTtBQUFFLDhCQUFtQixZQUFZO0FBQUUseURBQWlCO0FBQ25EO0FBQWEsSUFBdEIsTUFBTSxFQUFFO0FBQUUsOEJBQTBCLFlBQVk7QUFBRSxnRUFBaUI7QUFwQnpELG9CQUFvQixvQkFKaEMsU0FBUyxDQUFDLFVBQ1QsUUFBUSxFQUFFLG5DQUdSLGtDQTZCNkIsVUFBVTtHQWhDakIsVUFDeEIsUUFBUSxFQUFFLHZCQWdDWixRQUE0Qyx5QkFBeUI7QUFoQzVDLE1BQ3hCLENBQUMsUEErQnNFLEdBOUIzRCxvQkFBb0IsQ0FpWGhDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQ0Q7QUFBQyxTQWxYWSxvQkFBb0I7QUFBSSIsInNvdXJjZXNDb250ZW50IjpbImRlY2xhcmUgdmFyIGdvb2dsZTogYW55O1xuXG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIE9uSW5pdCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBHb29nbGVDaGFydHNMb2FkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vZ29vZ2xlLWNoYXJ0cy1sb2FkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBHb29nbGVDaGFydHNEYXRhVGFibGUsIEdvb2dsZUNoYXJ0c0RhdGFUYWJsZUludGVyZmFjZSB9IGZyb20gJy4uL2dvb2dsZS1jaGFydHMtZGF0YXRhYmxlJztcbmltcG9ydCB7IENoYXJ0UmVhZHlFdmVudCB9IGZyb20gJy4vY2hhcnQtcmVhZHktZXZlbnQnO1xuaW1wb3J0IHsgQ2hhcnRFcnJvckV2ZW50IH0gZnJvbSAnLi9jaGFydC1lcnJvci1ldmVudCc7XG5pbXBvcnQgeyBDaGFydFNlbGVjdEV2ZW50IH0gZnJvbSAnLi9jaGFydC1zZWxlY3QtZXZlbnQnO1xuaW1wb3J0IHtcbiAgQ2hhcnRNb3VzZUV2ZW50LFxuICBDaGFydE1vdXNlT3ZlckV2ZW50LFxuICBDaGFydE1vdXNlT3V0RXZlbnQsXG4gIEJvdW5kaW5nQm94LFxuICBEYXRhUG9pbnRQb3NpdGlvblxufSBmcm9tICcuL2NoYXJ0LW1vdXNlLWV2ZW50JztcbmltcG9ydCB7IENoYXJ0SFRNTFRvb2x0aXAgfSBmcm9tICcuL2NoYXJ0LWh0bWwtdG9vbHRpcCc7XG5pbXBvcnQgeyBSZWdpb25DbGlja0V2ZW50IH0gZnJvbSAnLi9nZW9jaGFydC1ldmVudHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdvb2dsZUNoYXJ0SW50ZXJmYWNlIGV4dGVuZHMgR29vZ2xlQ2hhcnRzRGF0YVRhYmxlSW50ZXJmYWNlIHtcbiAgY2hhcnRUeXBlOiBzdHJpbmc7XG4gIG9wdGlvbnM/OiBhbnk7XG5cbiAgY29tcG9uZW50PzogR29vZ2xlQ2hhcnRDb21wb25lbnQ7XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2dvb2dsZS1jaGFydCcsXG4gIHRlbXBsYXRlOiAnPGRpdj48L2Rpdj4nLFxufSlcbmV4cG9ydCBjbGFzcyBHb29nbGVDaGFydENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KCkgcHVibGljIGRhdGE6IEdvb2dsZUNoYXJ0SW50ZXJmYWNlO1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgY2hhcnRSZWFkeTogRXZlbnRFbWl0dGVyPENoYXJ0UmVhZHlFdmVudD47XG4gIEBPdXRwdXQoKSBwdWJsaWMgY2hhcnRSZWFkeU9uZVRpbWU6IEV2ZW50RW1pdHRlcjxDaGFydFJlYWR5RXZlbnQ+O1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgY2hhcnRFcnJvcjogRXZlbnRFbWl0dGVyPENoYXJ0RXJyb3JFdmVudD47XG4gIEBPdXRwdXQoKSBwdWJsaWMgY2hhcnRFcnJvck9uZVRpbWU6IEV2ZW50RW1pdHRlcjxDaGFydEVycm9yRXZlbnQ+O1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgY2hhcnRTZWxlY3Q6IEV2ZW50RW1pdHRlcjxDaGFydFNlbGVjdEV2ZW50PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBjaGFydFNlbGVjdE9uZVRpbWU6IEV2ZW50RW1pdHRlcjxDaGFydFNlbGVjdEV2ZW50PjtcblxuICBAT3V0cHV0KCkgcHVibGljIG1vdXNlT3ZlcjogRXZlbnRFbWl0dGVyPENoYXJ0TW91c2VPdmVyRXZlbnQ+O1xuICBAT3V0cHV0KCkgcHVibGljIG1vdXNlT3Zlck9uZVRpbWU6IEV2ZW50RW1pdHRlcjxDaGFydE1vdXNlT3ZlckV2ZW50PjtcblxuICBAT3V0cHV0KCkgcHVibGljIG1vdXNlT3V0OiBFdmVudEVtaXR0ZXI8Q2hhcnRNb3VzZU91dEV2ZW50PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBtb3VzZU91dE9uZVRpbWU6IEV2ZW50RW1pdHRlcjxDaGFydE1vdXNlT3V0RXZlbnQ+O1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgcmVnaW9uQ2xpY2s6IEV2ZW50RW1pdHRlcjxSZWdpb25DbGlja0V2ZW50PjtcbiAgQE91dHB1dCgpIHB1YmxpYyByZWdpb25DbGlja09uZVRpbWU6IEV2ZW50RW1pdHRlcjxSZWdpb25DbGlja0V2ZW50PjtcblxuICBwdWJsaWMgd3JhcHBlcjogYW55O1xuICBwcml2YXRlIGNsaTogYW55O1xuICBwcml2YXRlIG9wdGlvbnM6IGFueTtcblxuICBwcml2YXRlIEhUTUxlbDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgZGF0YVRhYmxlOiBHb29nbGVDaGFydHNEYXRhVGFibGU7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgICAgICAgICBwcml2YXRlIGxvYWRlclNlcnZpY2U6IEdvb2dsZUNoYXJ0c0xvYWRlclNlcnZpY2UpIHtcbiAgICB0aGlzLmNoYXJ0U2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMuY2hhcnRTZWxlY3RPbmVUaW1lID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMuY2hhcnRSZWFkeSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0UmVhZHlPbmVUaW1lID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMuY2hhcnRFcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0RXJyb3JPbmVUaW1lID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMubW91c2VPdmVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMubW91c2VPdmVyT25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3V0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMubW91c2VPdXRPbmVUaW1lID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMucmVnaW9uQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5yZWdpb25DbGlja09uZVRpbWUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5IVE1MZWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2Jyk7XG4gICAgaWYgKE9iamVjdC5pc0V4dGVuc2libGUodGhpcy5kYXRhKSkge1xuICAgICAgdGhpcy5kYXRhLmNvbXBvbmVudCA9IHRoaXM7XG4gICAgfVxuICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuZGF0YS5vcHRpb25zO1xuXG4gICAgdGhpcy5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmRyYXcoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBpbml0KCkge1xuICAgIGF3YWl0IHRoaXMubG9hZGVyU2VydmljZS5sb2FkKCk7XG4gICAgdGhpcy5yZWNyZWF0ZVdyYXBwZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVjcmVhdGVXcmFwcGVyKCkge1xuICAgIGlmICh0aGlzLndyYXBwZXIgPT09IHVuZGVmaW5lZCB8fCB0aGlzLndyYXBwZXIuZ2V0Q2hhcnRUeXBlKCkgIT09IHRoaXMuZGF0YS5jaGFydFR5cGUpIHtcbiAgICAgIHRoaXMuZGF0YVRhYmxlID0gbmV3IEdvb2dsZUNoYXJ0c0RhdGFUYWJsZSh0aGlzLmRhdGEpO1xuICAgICAgdGhpcy5kYXRhVGFibGUuZGF0YVRhYmxlQ2hhbmdlZC5zdWJzY3JpYmUoKGR0OiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5fZHJhdygpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIHNlZSBkYXRhVGFibGUgaW4gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vY2hhcnQvaW50ZXJhY3RpdmUvZG9jcy9yZWZlcmVuY2UjZ29vZ2xlLnZpc3VhbGl6YXRpb24uZHJhd2NoYXJ0XG4gICAgICBsZXQgdGVtcDogR29vZ2xlQ2hhcnRJbnRlcmZhY2UgPSB0aGlzLmRhdGE7XG4gICAgICBpZiAodGhpcy5kYXRhLmZpcnN0Um93SXNEYXRhKSB7XG4gICAgICAgIHRlbXAgPSBPYmplY3QuYXNzaWduKHRlbXAsIHRoaXMuZGF0YSk7XG4gICAgICAgIHRlbXAuZGF0YVRhYmxlID0gdGhpcy5kYXRhVGFibGUuZ2V0RGF0YVRhYmxlKCk7XG4gICAgICB9XG4gICAgICB0aGlzLndyYXBwZXIgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ2hhcnRXcmFwcGVyKHRlbXApO1xuICAgICAgdGhpcy5yZWdpc3RlckNoYXJ0V3JhcHBlckV2ZW50cygpO1xuXG4gICAgICAvKiBDYWxsaW5nIGRyYXcgZXZlbiB3aXRob3V0IGRhdGEgaXMgdGhlIG9ubHkgd2F5IHRvIHBhc3MgdGhlIEhUTWwgZWxlbWVudFxuICAgICAgICAgd2hlbiB1c2luZyB0aGUgY2hhcnQgaW4gYSBkYXNoYm9hcmQuIERvbid0IGRvIHRoaXMgaW4gYWxsIG90aGVyIGNhc2VzOlxuICAgICAgICAgaXQgYnJlYWtzIGZvcm1hdHRlcnMgd2l0aCByZW1vdGUgZGF0YSBzb3VyY2UsIGhlbmNlIHRoZSBjb25kaXRpb25hbC4gKi9cbiAgICAgIGlmICh0ZW1wLmRhdGFUYWJsZSA9PT0gdW5kZWZpbmVkICYmIHRlbXAuZGF0YVNvdXJjZVVybCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy53cmFwcGVyLmRyYXcodGhpcy5IVE1MZWwpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHt9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBfZHJhdygpIHtcbiAgICBjb25zdCBkdCA9IHRoaXMuZGF0YVRhYmxlLmdldERhdGFUYWJsZSgpO1xuICAgIGlmIChkdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY29udmVydE9wdGlvbnMoKTtcbiAgICB0aGlzLnJlY3JlYXRlV3JhcHBlcigpO1xuICAgIHRoaXMud3JhcHBlci5zZXRPcHRpb25zKHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy53cmFwcGVyLnNldERhdGFUYWJsZShkdCk7XG4gICAgdGhpcy53cmFwcGVyLmRyYXcodGhpcy5IVE1MZWwpO1xuICB9XG5cbiAgcHVibGljIGdldERhdGFUYWJsZSgpOiBHb29nbGVDaGFydHNEYXRhVGFibGUge1xuICAgIHJldHVybiB0aGlzLmRhdGFUYWJsZTtcbiAgfVxuXG4gIHB1YmxpYyBkcmF3KHZhbHVlPzogR29vZ2xlQ2hhcnRJbnRlcmZhY2UpIHtcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWUgPSB0aGlzLmRhdGE7XG4gICAgfVxuICAgIHRoaXMub3B0aW9ucyA9IHZhbHVlLm9wdGlvbnM7XG4gICAgdGhpcy5kYXRhVGFibGUuaW5pdCh2YWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlbGVjdG9yQnlTZXJpZXNUeXBlKHNlcmllc1R5cGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3Qgc2VsZWN0b3JzOiBhbnkgPSB7XG4gICAgICBiYXJzIDogJ2JhciMlcyMlcicsXG4gICAgICBoYXhpcyA6ICdoQXhpcyMwI2xhYmVsJyxcbiAgICAgIGxpbmU6ICdwb2ludCMlcyMlcicsXG4gICAgICBsZWdlbmQgOiAnbGVnZW5kZW50cnkjJXMnLFxuICAgICAgYXJlYTogJ3BvaW50IyVzIyVyJ1xuICAgIH07XG5cbiAgICBjb25zdCBzZWxlY3Rvcjogc3RyaW5nID0gc2VsZWN0b3JzW3Nlcmllc1R5cGVdO1xuXG4gICAgcmV0dXJuIHNlbGVjdG9yO1xuICB9XG5cbiAvKipcbiAgKiBHaXZlbiBhIGNvbHVtbiBudW1iZXIsIGNvdW50cyBob3cgbWFueVxuICAqIGNvbHVtbnMgaGF2ZSByb2w9PVwiZGF0YVwiLiBUaG9zZSBhcmUgbWFwcGVkXG4gICogb25lLXRvLW9uZSB0byB0aGUgc2VyaWVzIGFycmF5LiBXaGVuIHJvbCBpcyBub3QgZGVmaW5lZFxuICAqIGEgY29sdW1uIG9mIHR5cGUgbnVtYmVyIG1lYW5zIGEgc2VyaWVzIGNvbHVtbi5cbiAgKiBAcGFyYW0gY29sdW1uIHRvIGluc3BlY3RcbiAgKi9cbiAgcHJpdmF0ZSBnZXRTZXJpZXNCeUNvbHVtbihjb2x1bW46IG51bWJlcik6IG51bWJlciAge1xuICAgIGxldCBzZXJpZXMgPSAwO1xuICAgIGNvbnN0IGRhdGFUYWJsZSA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKTtcbiAgICBmb3IgKGxldCBpID0gY29sdW1uIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IHJvbGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uUm9sZShpKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uVHlwZShpKTtcbiAgICAgIGlmIChyb2xlID09PSAnZGF0YScgfHwgdHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgc2VyaWVzKys7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzZXJpZXM7XG4gIH1cblxuICBwcml2YXRlIGdldEJvdW5kaW5nQm94Rm9ySXRlbShpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbik6IEJvdW5kaW5nQm94IHtcbiAgICBsZXQgYm91bmRpbmdCb3ggPSB7dG9wOiAwLCBsZWZ0OiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwfTtcbiAgICBpZiAodGhpcy5jbGkpIHtcbiAgICAgIGNvbnN0IGNvbHVtbiA9IGl0ZW0uY29sdW1uO1xuICAgICAgY29uc3Qgc2VyaWVzID0gdGhpcy5nZXRTZXJpZXNCeUNvbHVtbihjb2x1bW4pO1xuICAgICAgY29uc3Qgcm93ID0gaXRlbS5yb3c7XG4gICAgICBsZXQgc2VyaWVzVHlwZSA9IHRoaXMub3B0aW9ucy5zZXJpZXNUeXBlO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZXJpZXMgJiYgdGhpcy5vcHRpb25zLnNlcmllc1tzZXJpZXNdICYmIHRoaXMub3B0aW9ucy5zZXJpZXNbc2VyaWVzXS50eXBlKSB7XG4gICAgICAgIHNlcmllc1R5cGUgPSB0aGlzLm9wdGlvbnMuc2VyaWVzW3Nlcmllc10udHlwZTtcbiAgICAgIH1cbiAgICAgIGlmIChzZXJpZXNUeXBlKSB7XG4gICAgICAgIGxldCBzZWxlY3RvciA9IHRoaXMuZ2V0U2VsZWN0b3JCeVNlcmllc1R5cGUoc2VyaWVzVHlwZSk7XG4gICAgICAgIGlmIChzZWxlY3Rvcikge1xuICAgICAgICAgICAgIHNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZSgnJXMnLCBzZXJpZXMgKyAnJykucmVwbGFjZSgnJWMnLCBjb2x1bW4gKyAnJykucmVwbGFjZSgnJXInLCByb3cgKyAnJyk7XG4gICAgICAgICAgICAgY29uc3QgYm94ID0gdGhpcy5jbGkuZ2V0Qm91bmRpbmdCb3goc2VsZWN0b3IpO1xuICAgICAgICAgICAgIGlmIChib3gpIHtcbiAgICAgICAgICAgICAgYm91bmRpbmdCb3ggPSBib3g7XG4gICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvdW5kaW5nQm94O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRWYWx1ZUF0UG9zaXRpb24ocG9zaXRpb246IERhdGFQb2ludFBvc2l0aW9uKTogYW55IHtcbiAgICBpZiAocG9zaXRpb24ucm93ID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBkYXRhVGFibGUgPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCk7XG4gICAgY29uc3QgdmFsdWUgPSBkYXRhVGFibGUuZ2V0VmFsdWUocG9zaXRpb24ucm93LCBwb3NpdGlvbi5jb2x1bW4pO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sdW1uVHlwZUF0UG9zaXRpb24ocG9zaXRpb246IERhdGFQb2ludFBvc2l0aW9uKTogc3RyaW5nIHtcbiAgICAgIGNvbnN0IGRhdGFUYWJsZSA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uVHlwZShwb3NpdGlvbi5jb2x1bW4pIHx8ICcnO1xuICAgICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBwcml2YXRlIGdldENvbHVtbkxhYmVsQXRQb3NpdGlvbihwb3NpdGlvbjogRGF0YVBvaW50UG9zaXRpb24pOiBzdHJpbmcge1xuICAgICAgY29uc3QgZGF0YVRhYmxlID0gdGhpcy53cmFwcGVyLmdldERhdGFUYWJsZSgpO1xuICAgICAgY29uc3QgdHlwZSA9IGRhdGFUYWJsZS5nZXRDb2x1bW5MYWJlbChwb3NpdGlvbi5jb2x1bW4pIHx8ICcnO1xuICAgICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBwcml2YXRlIGdldEhUTUxUb29sdGlwKCk6IENoYXJ0SFRNTFRvb2x0aXAge1xuICAgIGNvbnN0IHRvb2x0aXBFUiA9IG5ldyBFbGVtZW50UmVmKHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZ29vZ2xlLXZpc3VhbGl6YXRpb24tdG9vbHRpcCcpKTtcbiAgICByZXR1cm4gbmV3IENoYXJ0SFRNTFRvb2x0aXAodG9vbHRpcEVSKTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VNb3VzZUV2ZW50KGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKTogQ2hhcnRNb3VzZUV2ZW50IHtcbiAgICBjb25zdCBjaGFydFR5cGUgPSB0aGlzLndyYXBwZXIuZ2V0Q2hhcnRUeXBlKCk7XG4gICAgbGV0IGV2ZW50Q29sdW1uID0gaXRlbS5jb2x1bW47XG4gICAgaWYgKGV2ZW50Q29sdW1uID09IG51bGwpIHtcbiAgICAgIHN3aXRjaCAoY2hhcnRUeXBlKSB7XG4gICAgICAgIGNhc2UgJ1RpbWVsaW5lJzpcbiAgICAgICAgICBldmVudENvbHVtbiA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKS5nZXROdW1iZXJPZkNvbHVtbnMoKSA9PT0gMyA/IDAgOiAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGV2ZW50Q29sdW1uID0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZXZlbnRSb3cgPSBpdGVtLnJvdztcbiAgICBjb25zdCBteUl0ZW0gPSB7XG4gICAgICByb3c6IGV2ZW50Um93LFxuICAgICAgY29sdW1uOiBldmVudENvbHVtblxuICAgIH07XG4gICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICBwb3NpdGlvbjogaXRlbSxcbiAgICAgIGJvdW5kaW5nQm94OiB0aGlzLmdldEJvdW5kaW5nQm94Rm9ySXRlbShteUl0ZW0pLFxuICAgICAgdmFsdWU6IHRoaXMuZ2V0VmFsdWVBdFBvc2l0aW9uKG15SXRlbSksXG4gICAgICBjb2x1bW5UeXBlOiB0aGlzLmdldENvbHVtblR5cGVBdFBvc2l0aW9uKG15SXRlbSksXG4gICAgICBjb2x1bW5MYWJlbDogdGhpcy5nZXRDb2x1bW5MYWJlbEF0UG9zaXRpb24obXlJdGVtKVxuICAgIH07XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSB1bnJlZ2lzdGVyRXZlbnRzKCk6IHZvaWQge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy53cmFwcGVyLmdldENoYXJ0KCkpO1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy53cmFwcGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGFydEV2ZW50cygpOiB2b2lkIHtcbiAgICBjb25zdCBjaGFydCA9IHRoaXMud3JhcHBlci5nZXRDaGFydCgpO1xuICAgIHRoaXMuY2xpID0gY2hhcnQuZ2V0Q2hhcnRMYXlvdXRJbnRlcmZhY2UgPyBjaGFydC5nZXRDaGFydExheW91dEludGVyZmFjZSgpIDogbnVsbDtcbiAgICBpZiAodGhpcy5tb3VzZU92ZXIub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdmVyJywgKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3ZlckV2ZW50ID0gdGhpcy5wYXJzZU1vdXNlRXZlbnQoaXRlbSkgYXMgQ2hhcnRNb3VzZU92ZXJFdmVudDtcbiAgICAgICAgZXZlbnQudG9vbHRpcCA9IHRoaXMuZ2V0SFRNTFRvb2x0aXAoKTtcbiAgICAgICAgdGhpcy5tb3VzZU92ZXIuZW1pdChldmVudCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRoaXMubW91c2VPdmVyT25lVGltZS5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZE9uZVRpbWVMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdmVyJywgKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3ZlckV2ZW50ID0gdGhpcy5wYXJzZU1vdXNlRXZlbnQoaXRlbSkgYXMgQ2hhcnRNb3VzZU92ZXJFdmVudDtcbiAgICAgICAgZXZlbnQudG9vbHRpcCA9IHRoaXMuZ2V0SFRNTFRvb2x0aXAoKTtcbiAgICAgICAgdGhpcy5tb3VzZU92ZXJPbmVUaW1lLmVtaXQoZXZlbnQpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubW91c2VPdXQub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdXQnLCAoaXRlbTogRGF0YVBvaW50UG9zaXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdXRFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdXRFdmVudDtcbiAgICAgICAgdGhpcy5tb3VzZU91dC5lbWl0KGV2ZW50KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm1vdXNlT3V0T25lVGltZS5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZE9uZVRpbWVMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdXQnLCAoaXRlbTogRGF0YVBvaW50UG9zaXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdXRFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdXRFdmVudDtcbiAgICAgICAgdGhpcy5tb3VzZU91dE9uZVRpbWUuZW1pdChldmVudCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kYXRhLmNoYXJ0VHlwZSA9PT0gJ0dlb0NoYXJ0Jykge1xuICAgICAgaWYgKHRoaXMucmVnaW9uQ2xpY2sub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKGNoYXJ0LCAncmVnaW9uQ2xpY2snLCAoaXRlbTogUmVnaW9uQ2xpY2tFdmVudCkgPT4ge1xuICAgICAgICAgIHRoaXMucmVnaW9uQ2xpY2suZW1pdChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5yZWdpb25DbGlja09uZVRpbWUub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZE9uZVRpbWVMaXN0ZW5lcihjaGFydCwgJ3JlZ2lvbkNsaWNrJywgKGl0ZW06IFJlZ2lvbkNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLnJlZ2lvbkNsaWNrLmVtaXQoaXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGFydFdyYXBwZXJFdmVudHMoKTogdm9pZCB7XG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3JlYWR5JywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGFydFJlYWR5LmVtaXQoe21lc3NhZ2U6ICdDaGFydCByZWFkeSd9KTtcbiAgICB9KTtcblxuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIodGhpcy53cmFwcGVyLCAncmVhZHknLCAoKSA9PiB7XG4gICAgICB0aGlzLmNoYXJ0UmVhZHlPbmVUaW1lLmVtaXQoe21lc3NhZ2U6ICdDaGFydCByZWFkeSAob25lIHRpbWUpJ30pO1xuICAgICAgdGhpcy5yZWdpc3RlckNoYXJ0RXZlbnRzKCk7XG4gICAgfSk7XG5cbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIodGhpcy53cmFwcGVyLCAnZXJyb3InLCAoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jaGFydEVycm9yLmVtaXQoZXJyb3IgYXMgQ2hhcnRFcnJvckV2ZW50KTtcbiAgICB9KTtcblxuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIodGhpcy53cmFwcGVyLCAnZXJyb3InLCAoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jaGFydEVycm9yT25lVGltZS5lbWl0KGVycm9yIGFzIENoYXJ0RXJyb3JFdmVudCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZExpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3NlbGVjdCcsIHRoaXMuc2VsZWN0TGlzdGVuZXIsIHRoaXMuY2hhcnRTZWxlY3QpO1xuICAgIHRoaXMuYWRkT25lVGltZUxpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3NlbGVjdCcsIHRoaXMuc2VsZWN0TGlzdGVuZXIsIHRoaXMuY2hhcnRTZWxlY3RPbmVUaW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkTGlzdGVuZXIoc291cmNlOiBhbnksIGV2ZW50VHlwZTogc3RyaW5nLCBsaXN0ZW5lckZuOiBhbnksIGV2RW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4pIHtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIoc291cmNlLCBldmVudFR5cGUsICgpID0+IHtcbiAgICAgIGV2RW1pdHRlci5lbWl0KGxpc3RlbmVyRm4oKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFkZE9uZVRpbWVMaXN0ZW5lcihzb3VyY2U6IGFueSwgZXZlbnRUeXBlOiBzdHJpbmcsIGxpc3RlbmVyRm46IGFueSwgZXZFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55Pikge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIoc291cmNlLCBldmVudFR5cGUsICgpID0+IHtcbiAgICAgIGV2RW1pdHRlci5lbWl0KGxpc3RlbmVyRm4oKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG1vdXNlT3Zlckxpc3RlbmVyID0gKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdmVyRXZlbnQgPSB0aGlzLnBhcnNlTW91c2VFdmVudChpdGVtKSBhcyBDaGFydE1vdXNlT3ZlckV2ZW50O1xuICAgIGV2ZW50LnRvb2x0aXAgPSB0aGlzLmdldEhUTUxUb29sdGlwKCk7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBtb3VzZU91dExpc3RlbmVyID0gKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdXRFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdXRFdmVudDtcbiAgICByZXR1cm4gZXZlbnQ7XG4gIH1cblxuICBwcml2YXRlIHNlbGVjdExpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGV2ZW50OiBDaGFydFNlbGVjdEV2ZW50ID0ge1xuICAgICAgbWVzc2FnZTogJ3NlbGVjdCcsXG4gICAgICByb3c6IG51bGwsXG4gICAgICBjb2x1bW46IG51bGwsXG4gICAgICBzZWxlY3RlZFJvd1ZhbHVlczogW10sXG4gICAgICBzZWxlY3RlZFJvd0Zvcm1hdHRlZFZhbHVlczogW10sXG4gICAgICBjb2x1bW5MYWJlbDogJydcbiAgICB9O1xuICAgIGNvbnN0IHMgPSB0aGlzLndyYXBwZXIudmlzdWFsaXphdGlvbi5nZXRTZWxlY3Rpb24oKTtcbiAgICBjb25zdCBncyA9IHNbcy5sZW5ndGggLSAxXTtcbiAgICBpZiAoIWdzKSB7XG4gICAgICBldmVudC5tZXNzYWdlID0gJ2Rlc2VsZWN0JztcbiAgICAgIHJldHVybiBldmVudDtcbiAgICB9XG4gICAgY29uc3Qgc2VsZWN0aW9uOiBEYXRhUG9pbnRQb3NpdGlvbiA9IGdzO1xuICAgIGlmIChncy5yb3cgIT0gbnVsbCkge1xuICAgICAgZXZlbnQucm93ID0gc2VsZWN0aW9uLnJvdztcblxuICAgICAgY29uc3Qgc2VsZWN0ZWRSb3dWYWx1ZXMgPSBbXTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkUm93Rm9ybWF0dGVkVmFsdWVzID0gW107XG4gICAgICBjb25zdCBkYXRhVGFibGUgPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCk7XG4gICAgICBjb25zdCBudW1iZXJPZkNvbHVtbnMgPSBkYXRhVGFibGUuZ2V0TnVtYmVyT2ZDb2x1bW5zKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mQ29sdW1uczsgaSsrKSB7XG4gICAgICAgIHNlbGVjdGVkUm93VmFsdWVzLnB1c2goZGF0YVRhYmxlLmdldFZhbHVlKHNlbGVjdGlvbi5yb3csIGkpKTtcbiAgICAgICAgc2VsZWN0ZWRSb3dGb3JtYXR0ZWRWYWx1ZXMucHVzaChkYXRhVGFibGUuZ2V0Rm9ybWF0dGVkVmFsdWUoc2VsZWN0aW9uLnJvdywgaSkpO1xuICAgICAgfVxuICAgICAgZXZlbnQuc2VsZWN0ZWRSb3dWYWx1ZXMgPSBzZWxlY3RlZFJvd1ZhbHVlcztcbiAgICAgIGV2ZW50LnNlbGVjdGVkUm93Rm9ybWF0dGVkVmFsdWVzID0gc2VsZWN0ZWRSb3dGb3JtYXR0ZWRWYWx1ZXM7XG4gICAgfVxuICAgIGlmIChzZWxlY3Rpb24uY29sdW1uICE9IG51bGwpIHtcbiAgICAgIGV2ZW50LmNvbHVtbiA9IHNlbGVjdGlvbi5jb2x1bW47XG4gICAgICBldmVudC5jb2x1bW5MYWJlbCA9IHRoaXMuZ2V0Q29sdW1uTGFiZWxBdFBvc2l0aW9uKHNlbGVjdGlvbik7XG4gICAgfVxuICAgIGlmIChncy5uYW1lKSB7XG4gICAgICBldmVudC5jb2x1bW5MYWJlbCA9IGdzLm5hbWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBjb252ZXJ0T3B0aW9ucygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5vcHRpb25zID0gZ29vZ2xlLmNoYXJ0c1t0aGlzLmRhdGEuY2hhcnRUeXBlXS5jb252ZXJ0T3B0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG59XG4iXX0=