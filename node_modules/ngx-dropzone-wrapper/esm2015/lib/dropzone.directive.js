import { __decorate, __param } from "tslib";
import Dropzone from 'dropzone';
import { PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { NgZone, Inject, Optional, ElementRef, Renderer2, Directive, OnInit, OnDestroy, DoCheck, OnChanges, Input, Output, EventEmitter, SimpleChanges, KeyValueDiffer, KeyValueDiffers } from '@angular/core';
import { DROPZONE_CONFIG, DropzoneConfig, DropzoneEvents } from './dropzone.interfaces';
import * as ɵngcc0 from '@angular/core';
let DropzoneDirective = class DropzoneDirective {
    constructor(zone, renderer, elementRef, differs, platformId, defaults) {
        this.zone = zone;
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.differs = differs;
        this.platformId = platformId;
        this.defaults = defaults;
        this.configDiff = null;
        this.disabled = false;
        this.DZ_INIT = new EventEmitter();
        this.DZ_ERROR = new EventEmitter();
        this.DZ_SUCCESS = new EventEmitter();
        this.DZ_SENDING = new EventEmitter();
        this.DZ_CANCELED = new EventEmitter();
        this.DZ_COMPLETE = new EventEmitter();
        this.DZ_PROCESSING = new EventEmitter();
        this.DZ_DROP = new EventEmitter();
        this.DZ_DRAGSTART = new EventEmitter();
        this.DZ_DRAGEND = new EventEmitter();
        this.DZ_DRAGENTER = new EventEmitter();
        this.DZ_DRAGOVER = new EventEmitter();
        this.DZ_DRAGLEAVE = new EventEmitter();
        this.DZ_THUMBNAIL = new EventEmitter();
        this.DZ_ADDEDFILE = new EventEmitter();
        this.DZ_REMOVEDFILE = new EventEmitter();
        this.DZ_UPLOADPROGRESS = new EventEmitter();
        this.DZ_MAXFILESREACHED = new EventEmitter();
        this.DZ_MAXFILESEXCEEDED = new EventEmitter();
        this.DZ_SUCCESSMULTIPLE = new EventEmitter();
        this.DZ_SENDINGMULTIPLE = new EventEmitter();
        this.DZ_CANCELEDMULTIPLE = new EventEmitter();
        this.DZ_COMPLETEMULTIPLE = new EventEmitter();
        this.DZ_PROCESSINGMULTIPLE = new EventEmitter();
        this.DZ_RESET = new EventEmitter();
        this.DZ_QUEUECOMPLETE = new EventEmitter();
        this.DZ_TOTALUPLOADPROGRESS = new EventEmitter();
        const dz = Dropzone;
        dz.autoDiscover = false;
    }
    ngOnInit() {
        if (!isPlatformBrowser(this.platformId)) {
            return;
        }
        const params = new DropzoneConfig(this.defaults);
        params.assign(this.config); // Custom configuration
        this.renderer.addClass(this.elementRef.nativeElement, (params.maxFiles === 1) ? 'dz-single' : 'dz-multiple');
        this.renderer.removeClass(this.elementRef.nativeElement, (params.maxFiles === 1) ? 'dz-multiple' : 'dz-single');
        this.zone.runOutsideAngular(() => {
            this.instance = new Dropzone(this.elementRef.nativeElement, params);
        });
        if (this.disabled) {
            this.instance.disable();
        }
        if (this.DZ_INIT.observers.length) {
            this.zone.run(() => {
                this.DZ_INIT.emit(this.instance);
            });
        }
        // Add auto reset handling for events
        this.instance.on('success', () => {
            if (params.autoReset != null) {
                setTimeout(() => this.reset(), params.autoReset);
            }
        });
        this.instance.on('error', () => {
            if (params.errorReset != null) {
                setTimeout(() => this.reset(), params.errorReset);
            }
        });
        this.instance.on('canceled', () => {
            if (params.cancelReset != null) {
                setTimeout(() => this.reset(), params.cancelReset);
            }
        });
        // Add native Dropzone event handling
        DropzoneEvents.forEach((eventName) => {
            this.instance.on(eventName.toLowerCase(), (...args) => {
                args = (args.length === 1) ? args[0] : args;
                const output = `DZ_${eventName.toUpperCase()}`;
                const emitter = this[output];
                if (emitter.observers.length > 0) {
                    this.zone.run(() => {
                        emitter.emit(args);
                    });
                }
            });
        });
        if (!this.configDiff) {
            this.configDiff = this.differs.find(this.config || {}).create();
            this.configDiff.diff(this.config || {});
        }
    }
    ngOnDestroy() {
        if (this.instance) {
            this.zone.runOutsideAngular(() => {
                this.instance.destroy();
            });
            this.instance = null;
        }
    }
    ngDoCheck() {
        if (!this.disabled && this.configDiff) {
            const changes = this.configDiff.diff(this.config || {});
            if (changes && this.instance) {
                this.ngOnDestroy();
                this.ngOnInit();
            }
        }
    }
    ngOnChanges(changes) {
        if (this.instance && changes['disabled']) {
            if (changes['disabled'].currentValue !== changes['disabled'].previousValue) {
                if (changes['disabled'].currentValue === false) {
                    this.zone.runOutsideAngular(() => {
                        this.instance.enable();
                    });
                }
                else if (changes['disabled'].currentValue === true) {
                    this.zone.runOutsideAngular(() => {
                        this.instance.disable();
                    });
                }
            }
        }
    }
    dropzone() {
        return this.instance;
    }
    reset(cancel) {
        if (this.instance) {
            this.zone.runOutsideAngular(() => {
                this.instance.removeAllFiles(cancel);
            });
        }
    }
};
DropzoneDirective.ɵfac = function DropzoneDirective_Factory(t) { return new (t || DropzoneDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.KeyValueDiffers), ɵngcc0.ɵɵdirectiveInject(PLATFORM_ID), ɵngcc0.ɵɵdirectiveInject(DROPZONE_CONFIG, 8)); };
DropzoneDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DropzoneDirective, selectors: [["", "dropzone", ""]], inputs: { disabled: "disabled", config: ["dropzone", "config"] }, outputs: { DZ_INIT: "init", DZ_ERROR: "error", DZ_SUCCESS: "success", DZ_SENDING: "sending", DZ_CANCELED: "canceled", DZ_COMPLETE: "complete", DZ_PROCESSING: "processing", DZ_DROP: "drop", DZ_DRAGSTART: "dragStart", DZ_DRAGEND: "dragEnd", DZ_DRAGENTER: "dragEnter", DZ_DRAGOVER: "dragOver", DZ_DRAGLEAVE: "dragLeave", DZ_THUMBNAIL: "thumbnail", DZ_ADDEDFILE: "addedFile", DZ_REMOVEDFILE: "removedFile", DZ_UPLOADPROGRESS: "uploadProgress", DZ_MAXFILESREACHED: "maxFilesReached", DZ_MAXFILESEXCEEDED: "maxFilesExceeded", DZ_SUCCESSMULTIPLE: "successMultiple", DZ_SENDINGMULTIPLE: "sendingMultiple", DZ_CANCELEDMULTIPLE: "canceledMultiple", DZ_COMPLETEMULTIPLE: "completeMultiple", DZ_PROCESSINGMULTIPLE: "processingMultiple", DZ_RESET: "reset", DZ_QUEUECOMPLETE: "queueComplete", DZ_TOTALUPLOADPROGRESS: "totalUploadProgress" }, exportAs: ["ngxDropzone"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
DropzoneDirective.ctorParameters = () => [
    { type: NgZone },
    { type: Renderer2 },
    { type: ElementRef },
    { type: KeyValueDiffers },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DROPZONE_CONFIG,] }] }
];
__decorate([
    Input()
], DropzoneDirective.prototype, "disabled", void 0);
__decorate([
    Input('dropzone')
], DropzoneDirective.prototype, "config", void 0);
__decorate([
    Output('init')
], DropzoneDirective.prototype, "DZ_INIT", void 0);
__decorate([
    Output('error')
], DropzoneDirective.prototype, "DZ_ERROR", void 0);
__decorate([
    Output('success')
], DropzoneDirective.prototype, "DZ_SUCCESS", void 0);
__decorate([
    Output('sending')
], DropzoneDirective.prototype, "DZ_SENDING", void 0);
__decorate([
    Output('canceled')
], DropzoneDirective.prototype, "DZ_CANCELED", void 0);
__decorate([
    Output('complete')
], DropzoneDirective.prototype, "DZ_COMPLETE", void 0);
__decorate([
    Output('processing')
], DropzoneDirective.prototype, "DZ_PROCESSING", void 0);
__decorate([
    Output('drop')
], DropzoneDirective.prototype, "DZ_DROP", void 0);
__decorate([
    Output('dragStart')
], DropzoneDirective.prototype, "DZ_DRAGSTART", void 0);
__decorate([
    Output('dragEnd')
], DropzoneDirective.prototype, "DZ_DRAGEND", void 0);
__decorate([
    Output('dragEnter')
], DropzoneDirective.prototype, "DZ_DRAGENTER", void 0);
__decorate([
    Output('dragOver')
], DropzoneDirective.prototype, "DZ_DRAGOVER", void 0);
__decorate([
    Output('dragLeave')
], DropzoneDirective.prototype, "DZ_DRAGLEAVE", void 0);
__decorate([
    Output('thumbnail')
], DropzoneDirective.prototype, "DZ_THUMBNAIL", void 0);
__decorate([
    Output('addedFile')
], DropzoneDirective.prototype, "DZ_ADDEDFILE", void 0);
__decorate([
    Output('removedFile')
], DropzoneDirective.prototype, "DZ_REMOVEDFILE", void 0);
__decorate([
    Output('uploadProgress')
], DropzoneDirective.prototype, "DZ_UPLOADPROGRESS", void 0);
__decorate([
    Output('maxFilesReached')
], DropzoneDirective.prototype, "DZ_MAXFILESREACHED", void 0);
__decorate([
    Output('maxFilesExceeded')
], DropzoneDirective.prototype, "DZ_MAXFILESEXCEEDED", void 0);
__decorate([
    Output('successMultiple')
], DropzoneDirective.prototype, "DZ_SUCCESSMULTIPLE", void 0);
__decorate([
    Output('sendingMultiple')
], DropzoneDirective.prototype, "DZ_SENDINGMULTIPLE", void 0);
__decorate([
    Output('canceledMultiple')
], DropzoneDirective.prototype, "DZ_CANCELEDMULTIPLE", void 0);
__decorate([
    Output('completeMultiple')
], DropzoneDirective.prototype, "DZ_COMPLETEMULTIPLE", void 0);
__decorate([
    Output('processingMultiple')
], DropzoneDirective.prototype, "DZ_PROCESSINGMULTIPLE", void 0);
__decorate([
    Output('reset')
], DropzoneDirective.prototype, "DZ_RESET", void 0);
__decorate([
    Output('queueComplete')
], DropzoneDirective.prototype, "DZ_QUEUECOMPLETE", void 0);
__decorate([
    Output('totalUploadProgress')
], DropzoneDirective.prototype, "DZ_TOTALUPLOADPROGRESS", void 0);
DropzoneDirective = __decorate([ __param(4, Inject(PLATFORM_ID)),
    __param(5, Optional()), __param(5, Inject(DROPZONE_CONFIG))
], DropzoneDirective);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DropzoneDirective, [{
        type: Directive,
        args: [{
                selector: '[dropzone]',
                exportAs: 'ngxDropzone'
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.KeyValueDiffers }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [DROPZONE_CONFIG]
            }] }]; }, { disabled: [{
            type: Input
        }], DZ_INIT: [{
            type: Output,
            args: ['init']
        }], DZ_ERROR: [{
            type: Output,
            args: ['error']
        }], DZ_SUCCESS: [{
            type: Output,
            args: ['success']
        }], DZ_SENDING: [{
            type: Output,
            args: ['sending']
        }], DZ_CANCELED: [{
            type: Output,
            args: ['canceled']
        }], DZ_COMPLETE: [{
            type: Output,
            args: ['complete']
        }], DZ_PROCESSING: [{
            type: Output,
            args: ['processing']
        }], DZ_DROP: [{
            type: Output,
            args: ['drop']
        }], DZ_DRAGSTART: [{
            type: Output,
            args: ['dragStart']
        }], DZ_DRAGEND: [{
            type: Output,
            args: ['dragEnd']
        }], DZ_DRAGENTER: [{
            type: Output,
            args: ['dragEnter']
        }], DZ_DRAGOVER: [{
            type: Output,
            args: ['dragOver']
        }], DZ_DRAGLEAVE: [{
            type: Output,
            args: ['dragLeave']
        }], DZ_THUMBNAIL: [{
            type: Output,
            args: ['thumbnail']
        }], DZ_ADDEDFILE: [{
            type: Output,
            args: ['addedFile']
        }], DZ_REMOVEDFILE: [{
            type: Output,
            args: ['removedFile']
        }], DZ_UPLOADPROGRESS: [{
            type: Output,
            args: ['uploadProgress']
        }], DZ_MAXFILESREACHED: [{
            type: Output,
            args: ['maxFilesReached']
        }], DZ_MAXFILESEXCEEDED: [{
            type: Output,
            args: ['maxFilesExceeded']
        }], DZ_SUCCESSMULTIPLE: [{
            type: Output,
            args: ['successMultiple']
        }], DZ_SENDINGMULTIPLE: [{
            type: Output,
            args: ['sendingMultiple']
        }], DZ_CANCELEDMULTIPLE: [{
            type: Output,
            args: ['canceledMultiple']
        }], DZ_COMPLETEMULTIPLE: [{
            type: Output,
            args: ['completeMultiple']
        }], DZ_PROCESSINGMULTIPLE: [{
            type: Output,
            args: ['processingMultiple']
        }], DZ_RESET: [{
            type: Output,
            args: ['reset']
        }], DZ_QUEUECOMPLETE: [{
            type: Output,
            args: ['queueComplete']
        }], DZ_TOTALUPLOADPROGRESS: [{
            type: Output,
            args: ['totalUploadProgress']
        }], config: [{
            type: Input,
            args: ['dropzone']
        }] }); })();
export { DropzoneDirective };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHpvbmUuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyJuZ3gtZHJvcHpvbmUtd3JhcHBlci9saWIvZHJvcHpvbmUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLFFBQVEsTUFBTSxVQUFVLENBQUM7QUFFaEMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQ2pFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFDbEUsYUFBYSxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFeEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxjQUFjLEVBQ3ZCLGNBQWMsRUFBRSxNQUFNLHVCQUF1QixDQUFDOztBQU0vRCxJQUFhLGlCQUFpQixHQUE5QixNQUFhLGlCQUFpQjtBQUFHLElBMEMvQixZQUFvQixJQUFZLEVBQVUsUUFBbUIsRUFBVSxVQUFzQixFQUNuRixPQUF3QixFQUErQixVQUFrQixFQUNwQyxRQUFpQztBQUNoRixRQUhvQixTQUFJLEdBQUosSUFBSSxDQUFRO0FBQUMsUUFBUyxhQUFRLEdBQVIsUUFBUSxDQUFXO0FBQUMsUUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFDcEYsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7QUFBQyxRQUE4QixlQUFVLEdBQVYsVUFBVSxDQUFRO0FBQUMsUUFDckMsYUFBUSxHQUFSLFFBQVEsQ0FBeUI7QUFBQyxRQXpDekUsZUFBVSxHQUF1QyxJQUFJLENBQUM7QUFDaEUsUUFDVyxhQUFRLEdBQVksS0FBSyxDQUFDO0FBQ3JDLFFBR29DLFlBQU8sR0FBdUIsSUFBSSxZ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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQ0Q7QUFBQyxTQTdLWSxpQkFBaUI7QUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBEcm9wem9uZSBmcm9tICdkcm9wem9uZSc7XG5cbmltcG9ydCB7IFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBOZ1pvbmUsIEluamVjdCwgT3B0aW9uYWwsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgRGlyZWN0aXZlLFxuICBPbkluaXQsIE9uRGVzdHJveSwgRG9DaGVjaywgT25DaGFuZ2VzLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsXG4gIFNpbXBsZUNoYW5nZXMsIEtleVZhbHVlRGlmZmVyLCBLZXlWYWx1ZURpZmZlcnMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgRFJPUFpPTkVfQ09ORklHLCBEcm9wem9uZUNvbmZpZywgRHJvcHpvbmVDb25maWdJbnRlcmZhY2UsXG4gIERyb3B6b25lRXZlbnQsIERyb3B6b25lRXZlbnRzIH0gZnJvbSAnLi9kcm9wem9uZS5pbnRlcmZhY2VzJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2Ryb3B6b25lXScsXG4gIGV4cG9ydEFzOiAnbmd4RHJvcHpvbmUnXG59KVxuZXhwb3J0IGNsYXNzIERyb3B6b25lRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIERvQ2hlY2ssIE9uQ2hhbmdlcyB7XG4gIHByaXZhdGUgaW5zdGFuY2U6IGFueTtcblxuICBwcml2YXRlIGNvbmZpZ0RpZmY6IEtleVZhbHVlRGlmZmVyPHN0cmluZywgYW55PiB8IG51bGwgPSBudWxsO1xuXG4gIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgQElucHV0KCdkcm9wem9uZScpIGNvbmZpZz86IERyb3B6b25lQ29uZmlnSW50ZXJmYWNlO1xuXG4gIEBPdXRwdXQoJ2luaXQnICAgICAgICAgICAgICAgICAgKSBEWl9JTklUICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdlcnJvcicgICAgICAgICAgICAgICAgICkgRFpfRVJST1IgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3N1Y2Nlc3MnICAgICAgICAgICAgICAgKSBEWl9TVUNDRVNTICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2VuZGluZycgICAgICAgICAgICAgICApIERaX1NFTkRJTkcgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdjYW5jZWxlZCcgICAgICAgICAgICAgICkgRFpfQ0FOQ0VMRUQgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2NvbXBsZXRlJyAgICAgICAgICAgICAgKSBEWl9DT01QTEVURSAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgncHJvY2Vzc2luZycgICAgICAgICAgICApIERaX1BST0NFU1NJTkcgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ2Ryb3AnICAgICAgICAgICAgICAgICAgKSBEWl9EUk9QICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnZHJhZ1N0YXJ0JyAgICAgICAgICAgICApIERaX0RSQUdTVEFSVCAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdkcmFnRW5kJyAgICAgICAgICAgICAgICkgRFpfRFJBR0VORCAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2RyYWdFbnRlcicgICAgICAgICAgICAgKSBEWl9EUkFHRU5URVIgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnZHJhZ092ZXInICAgICAgICAgICAgICApIERaX0RSQUdPVkVSICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdkcmFnTGVhdmUnICAgICAgICAgICAgICkgRFpfRFJBR0xFQVZFICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgndGh1bWJuYWlsJyAgICAgICAgICAgICApIERaX1RIVU1CTkFJTCAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdhZGRlZEZpbGUnICAgICAgICAgICAgICkgRFpfQURERURGSUxFICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3JlbW92ZWRGaWxlJyAgICAgICAgICAgKSBEWl9SRU1PVkVERklMRSAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgndXBsb2FkUHJvZ3Jlc3MnICAgICAgICApIERaX1VQTE9BRFBST0dSRVNTICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdtYXhGaWxlc1JlYWNoZWQnICAgICAgICkgRFpfTUFYRklMRVNSRUFDSEVEICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ21heEZpbGVzRXhjZWVkZWQnICAgICAgKSBEWl9NQVhGSUxFU0VYQ0VFREVEICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdzdWNjZXNzTXVsdGlwbGUnICAgICAgICkgRFpfU1VDQ0VTU01VTFRJUExFICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3NlbmRpbmdNdWx0aXBsZScgICAgICAgKSBEWl9TRU5ESU5HTVVMVElQTEUgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnY2FuY2VsZWRNdWx0aXBsZScgICAgICApIERaX0NBTkNFTEVETVVMVElQTEUgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdjb21wbGV0ZU11bHRpcGxlJyAgICAgICkgRFpfQ09NUExFVEVNVUxUSVBMRSAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3Byb2Nlc3NpbmdNdWx0aXBsZScgICAgKSBEWl9QUk9DRVNTSU5HTVVMVElQTEUgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdyZXNldCcgICAgICAgICAgICAgICAgICkgRFpfUkVTRVQgICAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ3F1ZXVlQ29tcGxldGUnICAgICAgICAgKSBEWl9RVUVVRUNPTVBMRVRFICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgndG90YWxVcGxvYWRQcm9ncmVzcycgICApIERaX1RPVEFMVVBMT0FEUFJPR1JFU1MgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgem9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIGRpZmZlcnM6IEtleVZhbHVlRGlmZmVycywgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybUlkOiBPYmplY3QsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChEUk9QWk9ORV9DT05GSUcpIHByaXZhdGUgZGVmYXVsdHM6IERyb3B6b25lQ29uZmlnSW50ZXJmYWNlKVxuICB7XG4gICAgY29uc3QgZHogPSBEcm9wem9uZTtcblxuICAgIGR6LmF1dG9EaXNjb3ZlciA9IGZhbHNlO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zID0gbmV3IERyb3B6b25lQ29uZmlnKHRoaXMuZGVmYXVsdHMpO1xuXG4gICAgcGFyYW1zLmFzc2lnbih0aGlzLmNvbmZpZyk7IC8vIEN1c3RvbSBjb25maWd1cmF0aW9uXG5cbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgKHBhcmFtcy5tYXhGaWxlcyA9PT0gMSkgPyAnZHotc2luZ2xlJyA6ICdkei1tdWx0aXBsZScpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgIChwYXJhbXMubWF4RmlsZXMgPT09IDEpID8gJ2R6LW11bHRpcGxlJyA6ICdkei1zaW5nbGUnKTtcblxuICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLmluc3RhbmNlID0gbmV3IERyb3B6b25lKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBwYXJhbXMpO1xuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuaW5zdGFuY2UuZGlzYWJsZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLkRaX0lOSVQub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgIHRoaXMuRFpfSU5JVC5lbWl0KHRoaXMuaW5zdGFuY2UpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGF1dG8gcmVzZXQgaGFuZGxpbmcgZm9yIGV2ZW50c1xuICAgIHRoaXMuaW5zdGFuY2Uub24oJ3N1Y2Nlc3MnLCAoKSA9PiB7XG4gICAgICBpZiAocGFyYW1zLmF1dG9SZXNldCAhPSBudWxsKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZXNldCgpLCBwYXJhbXMuYXV0b1Jlc2V0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuaW5zdGFuY2Uub24oJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgaWYgKHBhcmFtcy5lcnJvclJlc2V0ICE9IG51bGwpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlc2V0KCksIHBhcmFtcy5lcnJvclJlc2V0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuaW5zdGFuY2Uub24oJ2NhbmNlbGVkJywgKCkgPT4ge1xuICAgICAgaWYgKHBhcmFtcy5jYW5jZWxSZXNldCAhPSBudWxsKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZXNldCgpLCBwYXJhbXMuY2FuY2VsUmVzZXQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIG5hdGl2ZSBEcm9wem9uZSBldmVudCBoYW5kbGluZ1xuICAgIERyb3B6b25lRXZlbnRzLmZvckVhY2goKGV2ZW50TmFtZTogRHJvcHpvbmVFdmVudCkgPT4ge1xuICAgICAgdGhpcy5pbnN0YW5jZS5vbihldmVudE5hbWUudG9Mb3dlckNhc2UoKSwgKC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICAgIGFyZ3MgPSAoYXJncy5sZW5ndGggPT09IDEpID8gYXJnc1swXSA6IGFyZ3M7XG5cbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gYERaXyR7ZXZlbnROYW1lLnRvVXBwZXJDYXNlKCl9YDtcblxuICAgICAgICBjb25zdCBlbWl0dGVyID0gdGhpc1tvdXRwdXQgYXMga2V5b2YgRHJvcHpvbmVEaXJlY3RpdmVdIGFzIEV2ZW50RW1pdHRlcjxhbnk+O1xuXG4gICAgICAgIGlmIChlbWl0dGVyLm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICBlbWl0dGVyLmVtaXQoYXJncyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaWYgKCF0aGlzLmNvbmZpZ0RpZmYpIHtcbiAgICAgIHRoaXMuY29uZmlnRGlmZiA9IHRoaXMuZGlmZmVycy5maW5kKHRoaXMuY29uZmlnIHx8IHt9KS5jcmVhdGUoKTtcblxuICAgICAgdGhpcy5jb25maWdEaWZmLmRpZmYodGhpcy5jb25maWcgfHwge30pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XG4gICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmluc3RhbmNlLmRlc3Ryb3koKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmluc3RhbmNlID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBuZ0RvQ2hlY2soKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRpc2FibGVkICYmIHRoaXMuY29uZmlnRGlmZikge1xuICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuY29uZmlnRGlmZi5kaWZmKHRoaXMuY29uZmlnIHx8IHt9KTtcblxuICAgICAgaWYgKGNoYW5nZXMgJiYgdGhpcy5pbnN0YW5jZSkge1xuICAgICAgICB0aGlzLm5nT25EZXN0cm95KCk7XG5cbiAgICAgICAgdGhpcy5uZ09uSW5pdCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSAmJiBjaGFuZ2VzWydkaXNhYmxlZCddKSB7XG4gICAgICBpZiAoY2hhbmdlc1snZGlzYWJsZWQnXS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXNbJ2Rpc2FibGVkJ10ucHJldmlvdXNWYWx1ZSkge1xuICAgICAgICBpZiAoY2hhbmdlc1snZGlzYWJsZWQnXS5jdXJyZW50VmFsdWUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuZW5hYmxlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY2hhbmdlc1snZGlzYWJsZWQnXS5jdXJyZW50VmFsdWUgPT09IHRydWUpIHtcbiAgICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5kaXNhYmxlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZHJvcHpvbmUoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgfVxuXG4gIHB1YmxpYyByZXNldChjYW5jZWw/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2UucmVtb3ZlQWxsRmlsZXMoY2FuY2VsKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19